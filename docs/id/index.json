[{"content":"  1) TLDR  wokai \u0026hellip; ketemu lagi sama saya, berrabe. Kali ini saya pengen sharing caranyoo monitoring openvpn yang simple 😍\nkenapa harus OpenVPN? dan kenapa harus di Monitoring? 😕\n pertama, OpenVPN itu protokol private tunneling yang paling secure dan paling banyak di implementasikan saat ini kedua, monitoring itu sangat crucial sekali \u0026hellip; klo sebuah sistem / app tidak di monitoring, itu sama seperti orang yang menanam padi tapi tidak pernah di rawat / dibiarin aja gitu. Berharap padinya akan tetap sehat dan bisa di panen  oiya, untuk OpenVPN Server saya setup otomatis menggunakan script nya pak angristan, soalnya kalo harus manual setting dari awal seperti setup certs, key dkk per client, pusing pala saya 😢 😫 \u0026hellip;\n   2) Simple Monitoring #1 (Bash Script)  cara monitoring OpenVPN yang pertama ini menggunakan script bash yang sudah saya buat. tinggal clone git nya saja di OpenVPN Server, dan langsung bisa di jalankan\n\u0026gt; git clone https://github.com/berrabe/monitoring-openvpn.git \u0026gt; cd monitoring-openvpn \u0026gt; chmod +x openvpn_mon.brb \u0026gt; ./openvpn_mon.brb mon nanti output nya akan seperti ini\nuntuk info lebih jelasnya, silahkan baca di readme github nya\n⚠️ Note : pastikan OpenVPN Server sudah di setup status log nya ke file /var/log/openvpn/status.log menggunakan directive status /var/log/openvpn/status.log\n   3) Simple Monitoring #2 (Docker Web Based)  monitoring kedua ini tampilan nya akan berupa web based, bukan CLI seperti cara pertama \u0026hellip; tapi syarat nya harus pakai docker, baca tutor nya di sini jika belum install\nnah, setelah uda punya docker, OpenVPN Server harus di setup management interface supaya aplikasi monitoring nya bisa work \u0026hellip; cara kerja nya beda dari cara pertama yang pakai shell script (parsing status log)\n  3.a) Management Interface cari file config OpenVPN Server nya, kalo saya ada di /etc/openvpn/server.conf\nterus, tambahkan directive config management \u0026lt;ip listen\u0026gt; \u0026lt;port listen\u0026gt; untuk mengaktifkan management interface, alhasil akan seperti ini\nport 1194 management 172.17.0.1 5555 proto udp dev tun ... IP 172.17.0.1 merupakan ip default dari network bridge docker0\nkarna saya install OpenVPN Server nya di host, dan Monitoring nya pakai Docker di atas network bridge default\nHOST SERVER +-------------------------------+ | | | | | OpenVPN Server \u0026lt;-----------+ | | | | | | | | | | | | Docker0 Bridge | DOCKER | | (172.17.0.1/16) | +---------------+ | | | | | | | | | Docker | | | | | OpenVPN +----------------------+ | | Monitoring | | | | | | | +---------------+ | +-------------------------------+ ⚠️ Note : jangan set listen IP ke 0.0.0.0 karna orang lain bisa akses Management Interface OpenVPN tanpa credentials\n  3.b) Deploy The Bad Guy saat nya deploy aplikasi monitoring nya, pakai compose file saja biar enak, copy script ke docker-compose.yml\nversion: \u0026#34;2.2\u0026#34; services: monitoring-OpenVPN: image: ruimarinho/openvpn-monitor container_name: monitoring-OpenVPN ports: - \u0026#34;80:80\u0026#34; environment: - OPENVPNMONITOR_DEFAULT_DATETIMEFORMAT=\u0026#34;%%d/%%m/%%Y\u0026#34; - OPENVPNMONITOR_DEFAULT_MAPS=True - OPENVPNMONITOR_DEFAULT_SITE=berrabe - OPENVPNMONITOR_SITES_0_ALIAS=UDP - OPENVPNMONITOR_SITES_0_HOST=172.17.0.1 - OPENVPNMONITOR_SITES_0_NAME=UDP Protocol - OPENVPNMONITOR_SITES_0_PORT=5555 - OPENVPNMONITOR_SITES_0_SHOWDISCONNECT=True restart: unless-stopped cpus: 1 mem_limit: 150M memswap_limit: 150M network_mode: bridge fire up aplikasi pakai command docker-compose up -d\njangan lupa di lihat status container nya sudah up atau belum\n\u0026gt; docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fd4e484f326a ruimarinho/openvpn-monitor \u0026#34;/entrypoint.sh guni…\u0026#34; 2 hours ago Up 2 hours 0.0.0.0:80-\u0026gt;80/tcp monitoring-OpenVPN   3.c) Access setelah semua setup selesai, sekarang aplikasi sudah bisa di lihat di \u0026lt;ip server\u0026gt;:80, tampilannya akan seperti ini\n  3.d) Secure The Access monitoring Docker Web Based tadi bisa di akses dari mana saja (public) tanpa harus memasukkan credential login dsb. Untuk Mengamankan nya saya menaruh Web App tadi di bawah reverse proxy\nuntuk reverse proxy nya berbasis docker juga, artikel bisa di lihat di docker reverse proxy #1 dan docker reverse proxy #2\nuntuk memasukkan aplikasi tadi ke bawah reverse proxy, modif docker-compose.yml menjadi\nversion: \u0026#34;2.2\u0026#34; services: monitoring-OpenVPN: image: ruimarinho/openvpn-monitor container_name: monitoring-OpenVPN environment: - OPENVPNMONITOR_DEFAULT_DATETIMEFORMAT=\u0026#34;%%d/%%m/%%Y\u0026#34; - OPENVPNMONITOR_DEFAULT_MAPS=True - OPENVPNMONITOR_DEFAULT_SITE=berrabe - OPENVPNMONITOR_SITES_0_ALIAS=UDP - OPENVPNMONITOR_SITES_0_HOST=172.17.0.1 - OPENVPNMONITOR_SITES_0_NAME=UDP Protocol - OPENVPNMONITOR_SITES_0_PORT=5555 - OPENVPNMONITOR_SITES_0_SHOWDISCONNECT=True - HTTPS_METHOD=redirect - VIRTUAL_HOST=vpn-mon.example.com - LETSENCRYPT_HOST=vpn-mon.example.com - NETWORK_ACCESS=internal restart: unless-stopped cpus: 1 mem_limit: 150M memswap_limit: 150M network_mode: bridge ganti domain vpn-mon.example.com ke domain yang telah di sediakan\nbedanya dari compose yang tidak secure apa?\n ports di hilangkan, container tidak butuh expose port standalone nya, karna traffic akan di lewatkan reverse proxy dulu reverse proxy Environment, ada beberapa tambahan pada bagian environment:  HTTPS_METHOD=redirect, akan membuat aplikasi force redirect (302) ke protokol HTTPS VIRTUAL_HOST=vpn-mon.example.com, aplikasi hanya bisa di akses pakai domain ini LETSENCRYPT_HOST=vpn-mon.example.com, domain nya sudah auto-generated SSL Certs letsencrypt, tidak perlu manual validasi lagi 😌 NETWORK_ACCESS=internal, domain hanya bisa di akses pakai ip private (OpenVPN), kalau di akses dari ip public akan Error Forbidden (403)    ","permalink":"https://berrabe.github.io/id/posts/2021/10-jan-2021/monitoring-openvpn/","summary":"1) TLDR  wokai \u0026hellip; ketemu lagi sama saya, berrabe. Kali ini saya pengen sharing caranyoo monitoring openvpn yang simple 😍\nkenapa harus OpenVPN? dan kenapa harus di Monitoring? 😕\n pertama, OpenVPN itu protokol private tunneling yang paling secure dan paling banyak di implementasikan saat ini kedua, monitoring itu sangat crucial sekali \u0026hellip; klo sebuah sistem / app tidak di monitoring, itu sama seperti orang yang menanam padi tapi tidak pernah di rawat / dibiarin aja gitu.","title":"Monitoring OpenVPN"},{"content":"  1) TLDR  oke \u0026hellip; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1\npada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server 😇\n+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------\u0026gt; | INTERNET | +-------\u0026gt; | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a.berrabe.com) | | | +-----------------------------+ domain tester pada docker reverse proxy #1 bernama a.berrabe.com, dimana container upstream nya berupa web server dari nginx:alpine\n⚠️ Note : domain tester hanya di gunakan untuk ngetest auto-gen mapping domain reverse-proxy nya dan auto-gen SSL Certs letsencrypt domain\nterus artikel lanjutan ini di buat untuk apa? 😟\njadi gini \u0026hellip; kemarin di docker reverse proxy #1 ada peringatan, bahwa reverse-proxy ini secara default hanya bisa di gunakan pada container yang berjalan di atas network bridge, selain itu? \u0026hellip; gatau dahh mwehehehe 😂   2) Selalu Punya Yang Baru  katakanlah saya ingin menjalankan aplikasi php framework laravel / CI, dengan infranya berupa stack nginx, php-fpm, dan mariaDB \u0026hellip; di docker, stack infra tadi biasanya di jalankan melalui docker-compose\nmasalahnya, secara default docker-compose akan membuat network baru untuk stack infra tadi, biasanya di ambil dari nama folder tempat file docker-compose.yml di simpan\ndocker-php-framework/ ├── docs/ ├── nginx/ ├── Dockerfile ├── docker-compose.yml jika file docker-compose.yml di atas di up dengan docker-compose up -d, maka secara default network dockerphpframework_default akan dibuat\nyang mana nantinya, docker reverse proxy tidak bisa memforward packet dari reverse-proxy ke aplikasi upstream (docker-php-framework) karna beda network\n docker reverse proxy di atas network bridge sedangkan docker-php-framework / upstream di atas network dockerphpframework_default     3) Menyelesaikan Masalah Tanpa Solusi  sebetulnya cara resolve nya sangat sederhana, ada 2 cara:\n ubah network di docker-compose.yml stack infra upstream ke network bridge, dan menggunakan fitur legacy links jika container di dalam stack ingin saling terhubung atau setup container docker reverse-proxy untuk join ke semua network yang tersedia, kecuali network host dan none  saya lebih memilih cara ke 2, karna lebih mudah menyesuaikan satu container agar bisa work dari pada sebaliknya \u0026hellip; dan juga cara 1 menggunakan fitur legacy links yang mana sudah tidak di rekomendasi oleh docker\n   4) Semua Serba Otomatis  okeh .. sekarang sudah jelas, yang perlu di lakukan adalah memasukkan container docker reverse proxy ke semua network agar proses proxy pass dapat bekerja 😵\nhhmm, tpi semisal saya jalanin 10 aplikasi, dan setiap aplikasi pakai compose, dan setiap compose punya network sendiri-sendiri, repot juga yak klo harus docker network connect atu-atu 😩\nuntuk itulah saya membuat script automasi nya 😎\n#!/bin/bash  # ------------------------------------------------- _CONTAINER_NAME_=$1 # ------------------------------------------------- clear echo -e \u0026#34;\\t ./ Docker Auto Join Network \\.\\n\\n\u0026#34; function check() { if [[ $? -eq 0 ]]; then echo \u0026#34;OK\u0026#34; else echo \u0026#34;ERROR $?\u0026#34; exit fi } echo -e \u0026#34; [+] LIST ALL DOCKER NETWORKS \u0026#34; _ALL_NET_=$(docker network list --format \u0026#34;{{.ID}}={{.Name}}\u0026#34; | grep -vE \u0026#34;host|none\u0026#34;) echo -e \u0026#34;$_ALL_NET_\u0026#34; | awk -F \u0026#39;=\u0026#39; \u0026#39;{printf \u0026#34; |--[-] %s \u0026gt;\u0026gt;\u0026gt; %s\\n\u0026#34;, $1, $2}\u0026#39; echo -e \u0026#34;\\n\\n [+] LIST [ $_CONTAINER_NAME_] CONTAINER CONNECTED NETWORKS\u0026#34; _ALL_CONN_=$(docker inspect $_CONTAINER_NAME_ | grep \u0026#34;NetworkID\u0026#34; | awk -F \u0026#39;\u0026#34;\u0026#39; \u0026#39;{print $4}\u0026#39; | cut -b -12) echo -e \u0026#34;$_ALL_CONN_\u0026#34; | awk \u0026#39;{if($1==\u0026#34;\u0026#34;) $1=\u0026#34;EMPTY\u0026#34;; printf \u0026#34; |--[-] %s\\n\u0026#34;, $1}\u0026#39; if [[ $_ALL_CONN_ == \u0026#34;\u0026#34; ]]; then exit fi echo -e \u0026#34;\\n\\n [+] DISCONNECT ALL NETWORKS ATTACHED TO [ $_CONTAINER_NAME_] CONTAINER\u0026#34; for i in $_ALL_CONN_; do printf \u0026#34; |--[-] Disconecting %s ... \u0026#34; \u0026#34;$i\u0026#34; docker network disconnect $i $_CONTAINER_NAME_ \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 check done echo -e \u0026#34;\\n\\n [+] CONNECTING [ $_CONTAINER_NAME_] TO ALL NETWORKS\u0026#34; for i in $(echo -e \u0026#34;$_ALL_NET_\u0026#34; | awk -F \u0026#39;=\u0026#39; \u0026#39;{print $1}\u0026#39;); do printf \u0026#34; |--[-] Connecting to %s ... \u0026#34; \u0026#34;$i\u0026#34; docker network connect $i $_CONTAINER_NAME_ \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 check done echo -ne \u0026#34;\\n\\n [+] RESTART [ $_CONTAINER_NAME_] CONTAINER ... \u0026#34; docker restart $_CONTAINER_NAME_ \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 check masih ingat dengan direktori struktur di docker reverse proxy #1 ?\ndi sana di buat file bernama auto_net.brb \u0026hellip; nah copy script di atas ke file itu, jangan lupa di beri exec permissions chmod +x auto_net.brb\n   5) TESS \u0026hellip; SSSTTTTT  agar container docker reverse proxy masuk ke semua network, caranya sangat simple 👍\n\u0026gt; ./auto_net.brb \u0026lt;nama container\u0026gt; di karenakan nama container default nya docker reverse proxy adalah reverse-proxy \u0026hellip; maka command nya jadi ./auto_net reverse-proxy\n./ Docker Auto Join Network \\. [+] LIST ALL DOCKER NETWORKS |--[-] 329d3a2e32d8 \u0026gt;\u0026gt;\u0026gt; 05nginxdirlist_default |--[-] cefc731a02d6 \u0026gt;\u0026gt;\u0026gt; 06monitoringstack_default |--[-] a72740956861 \u0026gt;\u0026gt;\u0026gt; berrabe_default |--[-] 7f23f3060488 \u0026gt;\u0026gt;\u0026gt; bridge [+] LIST [ reverse-proxy ] CONTAINER CONNECTED NETWORKS |--[-] 7f23f3060488 [+] DISCONNECT ALL NETWORKS ATTACHED TO [ reverse-proxy ] CONTAINER |--[-] Disconecting 7f23f3060488 ... OK [+] CONNECTING [ reverse-proxy ] TO ALL NETWORKS |--[-] Connecting to 329d3a2e32d8 ... OK |--[-] Connecting to cefc731a02d6 ... OK |--[-] Connecting to a72740956861 ... OK |--[-] Connecting to 7f23f3060488 ... OK [+] RESTART [ reverse-proxy ] CONTAINER ... OK dann tadaaaa \u0026hellip; container reverse-proxy sudah masuk ke semua network, jadi sekarang sudah bisa reverse-proxy ke semua container 👏 👏 👏\nuntuk lebih detail nya, bisa pakai command inspect\n\u0026gt; docker inspect reverse-proxy | grep \u0026#34;NetworkID\u0026#34; \u0026#34;NetworkID\u0026#34;: \u0026#34;329d3a2e32d80d5da8accfc71fdc1142f8ca06d12ae7ed328950136aba6c27c9\u0026#34;, \u0026#34;NetworkID\u0026#34;: \u0026#34;cefc731a02d65e46b8085675b978d4abcf60c7a112ef0b829cf137870bc65424\u0026#34;, \u0026#34;NetworkID\u0026#34;: \u0026#34;a727409568618db52186fdd2c2ed8bddc36bd2379c098c2b1eabaabf6c08c317\u0026#34;, \u0026#34;NetworkID\u0026#34;: \u0026#34;7f23f306048847b82a36cacb517a6121c395ed48a9f3b2f784921915b78501f7\u0026#34;, Penjelasan :\n jika di lihat, awalnya container reverse-proxy hanya connect ke network bridge dengan hash 7f23f3060488 kemudian script akan disconnect container reverse-proxy dari semua network untuk mencegah error dan collision baru deh container bakal di konekin ulang ke semua network, list network bisa di lihat pakai command docker network list  ","permalink":"https://berrabe.github.io/id/posts/2021/09-jan-2021/docker-reverse-proxy-2/","summary":"1) TLDR  oke \u0026hellip; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1\npada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server 😇\n+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------\u0026gt; | INTERNET | +-------\u0026gt; | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a.","title":"Docker Reverse Proxy #2"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah tanpa masalah \u0026hellip; YEAY 😎\nkali ini, saya pengen curhat dikit tentang jiwa kere hore saya \u0026hellip;. 😅\nJadi saya punya beberapa WEB-APP yang mau di jalanin, katakanlah ada Wordpress, Grafana dll \u0026hellip; tapi saya ga mau jalanin WEB-APP tadi di server-server terpisah kaya gini nih\n+-------------------------+ | | +----------\u0026gt; | SERVER 1 (WordPress) | | | | +--------------+ | +-------------------------+ +--------+ | | | | USER | +------\u0026gt; | INTERNET | +-+ +--------+ | | | +-------------------------+ +--------------+ | | | +----------\u0026gt; | SERVER 2 (GRAFANA) | | | +-------------------------+ saya mau nya yangggg \u0026hellip; paket hematttt kere hore ala anak kostan setiap akhir bulan, yang kalo makan nasi nya satu ember tapi lauknya cuman tempe goreng secuil 😩\npokoknya saya mau yang gimana caranya, semua WEB-APP yang buanyak tadi muat dalam satu server, dan AKTIF SEMUA\n+-------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------\u0026gt; | INTERNET | +-------\u0026gt; | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = dst | | | +-------------------------+ dan jugaaaa, per aplikasi ini di bedakan per domain, bukan per port \u0026hellip;. ingat ya, per DOMAIN, jadi wordpress di wp.berrabe.com dan grafana di dash.berrabe.com\nUda kere, banyak mau nya pulakk 😑 \u0026hellip; huufttt 😪\ntapi seperti biasaaa, tetap panik dan jangan tenang, karna berrabe selalu tidak punya solusi YEAY 😎\n   2) Reverse Proxy \u0026hellip; Gebetan Yang Terlupakan  Setelah bertapa selama 1 jam di depan laptop, akhirnya saya ketemu dan kenalan ama gebetan baru saya reverse proxy 😅 \u0026hellip; ni saya kasih fotonya\nhhmm \u0026hellip; hhmm \u0026hellip; hhmm \u0026hellip; 😱\nsepertinya saya mulai jatuh cinta \u0026hellip; eh, paham maksudnya 😅 \u0026hellip; kalau di lihat dari gambar, dalam satu server bisa di letakkan 2 website yang berbeda dengan di kasih reverse-proxy di depannya\nbtw, gambarnya kalo di lihat malah kayak cinta segitiga 😂\n   3) PDKT Sama Gebetan Baruuu  kayaknya bakal seru nih mainan ama gebetan reverse-proxy, hehe 😍\nperlu di ingat, semua teknologi ini berbasis docker \u0026hellip; baik reverse-proxy maupun webapps / upstream server nya, jadi pastikan uda paham apa itu docker dan istilah2 di dalamnya\nnah, gambaran jelasnya akan seperti ini\n 3.a) Persiapan Nembak Gebetan sebelum menggunakan reverse proxy, pastikan sudah ada otak nya dulu .. yaitu docker, cara install nya sangattttt mudahhh\n\u0026gt; curl -fsSL https://get.docker.com -o get-docker.sh \u0026gt; sh get-docker.sh \u0026gt; systemctl start docker  3.b) Setup Env okeh, supaya mudah dalam maintenance kedepannya \u0026hellip; maka lebih baik di buat folder hirarki berstruktur seperti di bawah\nReverse_Proxy/ ├── auto_net.brb ├── docker-compose.yml tidak semua file akan di isi langsung, bertahap \u0026hellip; karna artikel ini akan puanjang 😱\n   4) Compose File != Surat Cinta  setelah selesai membuat struktur folder, saat nya mengisi file-file yang telah di buat \u0026hellip; copy config di bawah ke file docker-compose.yml\nversion: \u0026#34;2.2\u0026#34; services: reverse-proxy: image: jwilder/nginx-proxy:alpine container_name: reverse-proxy volumes: - /var/run/docker.sock:/tmp/docker.sock:ro - ./reverse-proxy/cert:/etc/nginx/certs - ./reverse-proxy/vhost.d:/etc/nginx/vhost.d - ./reverse-proxy/html:/usr/share/nginx/html - ./reverse-proxy/dhparam:/etc/nginx/dhparam - ./conf/my_proxy.conf:/etc/nginx/conf.d/my_proxy.conf:ro ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; environment: - HTTPS_METHOD=noredirect - DEFAULT_HOST=example.com restart: unless-stopped cpus: 1 mem_limit: 100M memswap_limit: 100M network_mode: bridge reverse-proxy-letencrypt: image: jrcs/letsencrypt-nginx-proxy-companion container_name: reverse-proxy-letencrypt volumes_from: - reverse-proxy volumes: - /var/run/docker.sock:/var/run/docker.sock:ro - ./reverse-proxy/acme:/etc/acme.sh environment: - DEFAULT_EMAIL=xxx@example.com depends_on: - reverse-proxy restart: unless-stopped cpus: 1 mem_limit: 100M memswap_limit: 100M network_mode: bridge ⚠️ Note : Oiya, jangan lupa ganti beberapa value yang ada kata example.com ke domain yang sudah di sediakan\n   5) Jalanin Aja Dulu  menjalankan docker-compose reverse-proxy ini sangat mudah \u0026hellip; tidak seperti menjalankan hubungan yang tidak pasti 😞\n\u0026gt; docker-compose up -d Starting reverse-proxy ... done Starting reverse-proxy-letencrypt ... done untuk melihat status container nya, apakah sudah up / restart gegara ada error\n\u0026gt; docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 67627ced6c7e jrcs/letsencrypt-nginx-proxy-companion \u0026#34;/bin/bash /app/entr…\u0026#34; 3 seconds ago Up 2 seconds reverse-proxy-letencrypt 59f8fc51bfbc jwilder/nginx-proxy:alpine \u0026#34;/app/docker-entrypo…\u0026#34; 21 seconds ago Up 2 seconds 0.0.0.0:80-\u0026gt;80/tcp, 0.0.0.0:443-\u0026gt;443/tcp reverse-proxy    6) Testing  untuk testing, pastikan sudah punya domain sendiri \u0026hellip; contoh nya di sini berrabe.com yang di pointing ke ip server 1.2.3.4 \u0026hellip; jangan lupa, server nya yang sudah ada reverse-proxy nya\n1. berrabe.com ----\u0026gt; 1.2.3.4 2. a.berrabe.com ----\u0026gt; 1.2.3.4 3. b.berrabe.com ----\u0026gt; 1.2.3.4 setelah di pastikan domain sudah ada dan resolved dengan benar ke ip server, jalankan web server sederhana untuk mengecek apakah reverse-proxy sudah berjalan dengan semestinya\n\u0026gt; docker run -d \\  --name web \\  -e VIRTUAL_HOST=a.berrabe.com \\  -e LETSENCRYPT_HOST=a.berrabe.com \\  nginx:alpine untuk melihat apakah ada error saat proses auto-generated conf dan ssl certs berjalan, bisa di lihat pakai command\n\u0026gt; docker-compose logs -f seharusnya docker-reverse-proxy yang tadi di jalankan menggunakan compose mendeteksi adanya container nginx:alpine diatas dan otomatis men-generated conf untuk nginx dan validasi ssl certs\ndannn \u0026hellip; tadaaa, reverse-proxy bisa di gunakan\n\u0026gt; curl -s -I http://a.berrabe.com | head -n 1 HTTP/1.1 200 OK \u0026gt; curl -s -I https://a.berrabe.com | head -n 1 HTTP/2 302 ⚠️ Note : agar reverse-proxy berhasil, pastikan antara container reverse-proxy dan container upstream harus dalam satu network (default bridge) \u0026hellip; lihat di sini\n   7) Untuk Yang Kepo  untuk yang kepo bagaimana cara kerja docker ini\n pertama, kita menjalankan docker reverse-proxy menggunakan docker-compose \u0026hellip; yang akan menciptakan 2 container, yaitu reverse-proxy dan reverse-proxy-letencrypt  reverse-proxy untuk auto-gen conf dan handle nginx reverse proxy lewat proxy pass reverse-proxy-letencrypt untuk auto-gen dan validasi SSL Certs   setelah 2 container RP tadi berjalan, saat nya menjalankan WEB-APP / Upstream Server (contoh: nginx:alpine) saat WEB-APP berjalan dan status nya UP, maka 2 container RP tadi tau kalau ada container baru, gimana bisa tahu? karna dia komunikasi dengan docker.sock jika container baru yang sudah UP tadi terdapat 2 environment variable seperti VIRTUAL_HOST dan LETSENCRYPT_HOST, maka 2 container RP akan men-generated conf sesuai dengan :  VIRTUAL_HOST untuk generated domain mapping ke nginx conf, terdapat di /etc/nginx/conf.d/default.conf pada container reverse-proxy LETSENCRYPT_HOST untuk generated dan validasi SSL Certs domain menggunakan letsencrypt       8) Peringatan  Agar reverse-proxy ini bekerja, pastikan antara container reverse-proxy dan container upstream (contoh: nginx-alpine) berada dalam satu network (default bridge) \u0026hellip; jika semisal upstream di jalan kan sebagai docker-compose up yang biasanya akan otomatis auto generated nama network sendiri, maka container reverse-proxy tadi harus di masukkan ke network tersebut \u0026hellip; artikel nya ada di docker reverse proxy #2\njika yang ndak mau repot-repot copy paste script di atas, tinggal clone github saya di sini\n","permalink":"https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah tanpa masalah \u0026hellip; YEAY 😎\nkali ini, saya pengen curhat dikit tentang jiwa kere hore saya \u0026hellip;. 😅\nJadi saya punya beberapa WEB-APP yang mau di jalanin, katakanlah ada Wordpress, Grafana dll \u0026hellip; tapi saya ga mau jalanin WEB-APP tadi di server-server terpisah kaya gini nih\n+-------------------------+ | | +----------\u0026gt; | SERVER 1 (WordPress) | | | | +--------------+ | +-------------------------+ +--------+ | | | | USER | +------\u0026gt; | INTERNET | +-+ +--------+ | | | +-------------------------+ +--------------+ | | | +----------\u0026gt; | SERVER 2 (GRAFANA) | | | +-------------------------+ saya mau nya yangggg \u0026hellip; paket hematttt kere hore ala anak kostan setiap akhir bulan, yang kalo makan nasi nya satu ember tapi lauknya cuman tempe goreng secuil 😩","title":"Docker Reverse Proxy #1"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah tanpa solusi \u0026hellip; YEAY 😎\nkali ini, saya pengen sharing caranya setup SFTP (SSH File Transfer Protocol) yang isolated.\nApa itu isolated dan kenapa harus isolated? \u0026hellip; mari saya critain dulu\njadi gini \u0026hellip; suatu ketika client request untuk di buatkan akun SFTP, yang mana di khususkan untuk download / upload file-file pada folder tertentu saja\nTapi saya berfikir, kalau saya setup SFTP nya pakai SSH yang di gunakan untuk remote dan config server (Port 22), takutnya jadi berrabe 😂 😂\nsiapa tau tangan client jail \u0026hellip;. pengen ngetest system, trus dia nyoba meng-eksploitasi system buat loncat dari chroot SSH, trus setelah keluar dia maintenance user ke root dengan privilege escalation, trus setelah dari root malah otak-atik naruh backdoor dsb, trus trus trus dan akhirnya nabrak 😩 😩\nhhmm, saya termasuk orang yang posesif dan overprotektif sekali sepertinya terhadap pacar, eh \u0026hellip; server maksudnya 😪 😪   2) The Real Helper \u0026hellip; Docker!!  saya suka memakai docker, karna nantinya, tools / app yang berjalan di dalamnya akan bersifat isolated tetapi tetap enteng, tidak seperti memakai Virtual Machine\ndan saya akan setup SFTP di dalam docker, yang nantinya akan terpisah dari SSH utama yang di gunakan untuk remote dan config server \u0026hellip; 😎\nyahh walaupun sudah ada laporan bahwa ada security researcher yang bisa keluar dari isolated env docker ke host system, tapi setidaknya saya sudah menambah layer security dan mengurangi attack vector yang akan terjadi kedepannya 👍\n 2.a) Install Docker pastikan docker sudah terinstall, jika belum ikutin langkah di bawah ini \u0026hellip; please jangan nanya knapa harus install docker 😤\n\u0026gt; curl -fsSL https://get.docker.com -o get-docker.sh \u0026gt; sh get-docker.sh \u0026gt; systemctl start docker  2.b) Setup Env setelah docker terinstall, saya akan membuat folder SFTP-Isolated-berrabe/berrabe yang di gunakan untuk menampung file-file dan script SFTP\n\u0026gt; mkdir -p SFTP-Isolated-berrabe/upload \u0026gt; cd SFTP-Isolated-berrabe \u0026gt; chmod -R 666 upload    3) The Power Of Copas (Copy/Paste)  setelah docker ter install, saatnya setup SFTP nya agar berjalan di bawah docker dan bersifat isolated \u0026hellip;\n 3.a) Script dri pada config manual, saya lebih suka config otomatis, untuk itu saya membuat script yang sangat sederhana ini\n#!/bin/bash  # ------------------------------------------------- _CONTAINER_NAME_=\u0026#34;SFTP-Isolated-berrabe\u0026#34; _CONTAINER_VOL_NAME=\u0026#34;upload\u0026#34; _SFTP_PORT_=2323 _SFTP_USER_=\u0026#34;berrabe\u0026#34; _SFTP_PASS_=\u0026#34;iloveyou3000\u0026#34; _SFTP_UID_=\u0026#34;1000\u0026#34; _SFTP_GUID_=\u0026#34;1000\u0026#34; _SFTP_FOLDER_BINDING_=\u0026#34;$(pwd)/upload\u0026#34; # ------------------------------------------------- clear echo -ne \u0026#34; [+] Stopping $_CONTAINER_NAME_Container ..... \u0026#34; docker rm -f $_CONTAINER_NAME_ \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [[ $? -eq 0 ]]; then echo \u0026#34;OK\u0026#34; else echo \u0026#34;ERROR $?\u0026#34; exit fi echo -ne \u0026#34; [+] Starting New $_CONTAINER_NAME_Container ..... \u0026#34; docker run \\  --name $_CONTAINER_NAME_ \\  -v $_SFTP_FOLDER_BINDING_:/home/$_SFTP_USER_/$_CONTAINER_VOL_NAME \\  -p $_SFTP_PORT_:22 \\  -d atmoz/sftp:alpine \\  $_SFTP_USER_:$_SFTP_PASS_:$_SFTP_UID_:$_SFTP_GUID_ \\  \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [[ $? -eq 0 ]]; then echo \u0026#34;OK\u0026#34; else echo \u0026#34;ERROR $?\u0026#34; exit fi docker logs -f $_CONTAINER_NAME_ ⚠️ Note : copy script ke file SFTP-Isolated-berrabe/run.sh, jangan lupa di beri execute permission dengan cara chmod +x run.sh \u0026hellip; ingat, beri execute permission, bukan harapan palsu 😊\n 3.a) Config The Script jika di lihat di baris paling atas, ada beberapa konfigurasi default \u0026hellip; jika ingin diganti, tinggal sesuaikan saja\n_CONTAINER_NAME_=\u0026#34;SFTP-Isolated-berrabe\u0026#34; _CONTAINER_VOL_NAME=\u0026#34;upload\u0026#34; _SFTP_PORT_=2323 _SFTP_USER_=\u0026#34;berrabe\u0026#34; _SFTP_PASS_=\u0026#34;iloveyou3000\u0026#34; _SFTP_UID_=\u0026#34;\u0026#34; _SFTP_GUID_=\u0026#34;\u0026#34; _SFTP_FOLDER_BINDING_=\u0026#34;$(pwd)/upload\u0026#34; Penejelasan :\n Container Name : nama SFTP container saat di lihat pada command docker ps -a Container Volume : nama folder yang ada pada saat konek ke dalam SFTP, biar gampang, samakan dengan _SFTP_FOLDER_BINDING_ SFTP Port : port SFTP yang di gunakan client untuk konek SFTP User : username untuk masuk ke SFTP SFTP Port : password untuk masuk ke SFTP SFTP UID / GUID : di gunakan agar bisa read/write, isi sesuai UID / GUID user di host system, lihat di /etc/passwd, default kosong (hanya read)  ⚠️ Note : UID / GUID tidak di butuhkan jika folder upload sudah di set permission ke 666 / rw seperti di sini\n   4) Start The Show  setelah semua setup dan konfigurasi selesai, jalankan dengan command ./run.sh\n\u0026gt; ./run.sh [+] Stopping SFTP-Isolated-berrabe Container ..... OK [+] Starting New SFTP-Isolated-berrabe Container ..... OK ... untuk melihat status container, apakah sudah jalan atau ada error, gunakan command docker ps -a\n\u0026gt; docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 931768b6ca16 atmoz/sftp:alpine \u0026#34;/entrypoint berrabe…\u0026#34; 39 minutes ago Up 39 minutes 0.0.0.0:2323-\u0026gt;22/tcp SFTP-Isolated-berrabe ⚠️ Note : untuk run pertama kali, sedikit lama, karna harus mendownload image dari docker hub repo \u0026hellip; tekan CTRL+C jika ingin keluar\n   5) Testing  setelah SFTP di jalankan, saat nya coba untuk konek, bisa pakai filezilla atau SFTP CLI \u0026hellip; sama aja konsepnya\n\u0026gt; sftp -P 2323 berrabe@x.x.x.x berrabe@x.x.x.x password: Connected to x.x.x.x. sftp\u0026gt; ls upload sftp\u0026gt; cd upload/ sftp\u0026gt; put index.php . Uploading index.php to /upload/./index.php index.php 100% 1281 1.0MB/s 00:00 sftp\u0026gt; ls index.php folder upload sesuai dengan config default, dan di sini saya berhasil upload file index.php dari local ke server karna sudah di setting folder permission atau adanya UID / GUID\n","permalink":"https://berrabe.github.io/id/posts/2021/07-jan-2021/isolated-sftp-env-with-docker/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah tanpa solusi \u0026hellip; YEAY 😎\nkali ini, saya pengen sharing caranya setup SFTP (SSH File Transfer Protocol) yang isolated.\nApa itu isolated dan kenapa harus isolated? \u0026hellip; mari saya critain dulu\njadi gini \u0026hellip; suatu ketika client request untuk di buatkan akun SFTP, yang mana di khususkan untuk download / upload file-file pada folder tertentu saja","title":"Isolated SFTP Env With Docker"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing dikit tentang gimane caranya kasih notif ke tele kalau ada yang login ke server lewat SSH atau interactive shell\n knapa harus ke telegram?  ya karna biar simpel aja gitu sembari chat ama pacar temen, bisa lihat notif server + bisa di buka di manapun (HP, Website, Desktop) dengan cepat tanpa buka WebApp, login dst kayak pake ELK, Grafana Loki dkk\n dan knapa harus di kasih notif saat login SSH?  buat info siapa aja yang lagi akses server, kan klo server nya bermasalah ada yang bisa di salahin 😂 😂, tugas saya sebagai Administrator berkurang sikit 😴\nwokai tanpa banyak basa-basi langsung gassss \u0026hellip;\n   2) Script !!!  oke di sini saya kasih shell script nya, ini script yang tugasnya detect ssh login dan kasih notif + logging \u0026hellip; bukan mendeteksi doi lagi chat an ama siapa aja lho ya 😌\ncopy script yang ada di bawah ini ke file namanya login-ssh.sh pada server yang ingin di montoring\n#!/usr/bin/env bash  # =============================================================================== _EXCLUDE_IP_=( \u0026#34;127.0.0.1\u0026#34; \u0026#34;::1\u0026#34; ) _USER_ID_=( -10xxxx -11xxxx ) _TOKEN_TELEGRAM_=\u0026#34;1xxxxx:xxxxxxxxxxxxxxx\u0026#34; _LOG_FILE=\u0026#34;/var/log/ssh-login.log\u0026#34; # =============================================================================== TelegramNotif () { echo -ne \u0026#34;[+] Welcome To $(hostname -s)Server \u0026#34; curl -s -X POST \\ \thttps://api.telegram.org/bot$_TOKEN_TELEGRAM_/sendMessage \\ \t-d chat_id=$1 \\ \t-d text=\u0026#34;$2\u0026#34; \\ \t-d parse_mode=html \\ \t-d disable_web_page_preview=true \\ \t\u0026gt; /dev/null if [[ $? -eq 0 ]]; then echo \u0026#34;[ OK ]\u0026#34; Logging \u0026#34;$ClientIP_as $USER... Notif Success\u0026#34; else error_=$? echo \u0026#34;[ ERROR $error_| Contact Server Administrator ]\u0026#34; Logging \u0026#34;$ClientIP_as $USER... Notif ERROR $error_\u0026#34; fi } Logging () { date_=$(date \u0026#34;+%d-%b-%Y\u0026#34;) time_=$(date \u0026#34;+%H:%M:%S\u0026#34;) echo -e \u0026#34;[ SSH ] [ $date_] [ $time_] \u0026gt;\u0026gt; $1\u0026#34; \u0026gt;\u0026gt; $_LOG_FILE } Filter () { for i in \u0026#34;${_USER_ID_[@]}\u0026#34; do ClientIP_=$1 dateTime_=$(date \u0026#34;+%d %b %Y %H:%M:%S\u0026#34;) ServerHostname_=$(hostname -s) IPInfoAPI_=\u0026#34;https://ipinfo.io/${ClientIP_}\u0026#34; IPVPN=$(ip a | grep -E \u0026#34;inet.*tun\u0026#34; | awk \u0026#39;{sub(/\\/.*/,\u0026#34;\u0026#34;);print $2}\u0026#39;) NotifText_=\u0026#34; #ssh_login #$(echo $ServerHostname_ | sed -E \u0026#39;s/-|\\./_/g\u0026#39;)_login [#] \u0026lt;b\u0026gt;$dateTime_\u0026lt;/b\u0026gt; [=] \u0026lt;b\u0026gt;$ClientIP_\u0026lt;/b\u0026gt; \u0026lt;i\u0026gt;connect as\u0026lt;/i\u0026gt; \u0026lt;b\u0026gt;$USER\u0026lt;/b\u0026gt; \u0026lt;i\u0026gt;on\u0026lt;/i\u0026gt; \u0026lt;b\u0026gt;$ServerHostname_[ $IPVPN]\u0026lt;/b\u0026gt; [?] \u0026lt;i\u0026gt;More Info on\u0026lt;/i\u0026gt; \u0026lt;b\u0026gt;$IPInfoAPI_\u0026lt;/b\u0026gt;\u0026#34; TelegramNotif $i \u0026#34;$NotifText_\u0026#34; done } if [ -n \u0026#34;$SSH_CLIENT\u0026#34; ]; then ClientIP_=$(echo $SSH_CLIENT | awk \u0026#39;{print $1}\u0026#39;) Start_=1 for i in \u0026#34;${_EXCLUDE_IP_[@]}\u0026#34; do if [[ $i == $ClientIP_ ]]; then Logging \u0026#34;Excluded IP $USER@ $i\u0026#34; Start_=0 fi done fi if [[ $Start_ -eq 1 ]]; then Filter $ClientIP_ fi    3) How To  trus abis di copy ke file login-ssh.sh, cara jalanin nya gimane? \u0026hellip;\nwaittt, sebelum di jalanin, script nya harus di setup agar berfungsi sesuai keingingan\n 3.a) Konfigurasi Script di bagian paling atas script, sesuaikan variabel dengan setup / credential yang ada\n_EXCLUDE_IP_=( \u0026#34;127.0.0.1\u0026#34; \u0026#34;::1\u0026#34; ) _USER_ID_=( -10xxxx -11xxxx ) _TOKEN_TELEGRAM_=\u0026#34;1xxxxx:xxxxxxxxxxxxxxx\u0026#34; _LOG_FILE=\u0026#34;/var/log/ssh-login.log\u0026#34; sesuaikan user id dan token telegram \u0026hellip;\nuntuk mendapatkan token telegram bisa buat di @botFather dan untuk user id bisa di lihat dengan API https://api.telegram.org/bot\u0026lt;BOTID\u0026gt;/getUpdates \u0026hellip; btw untuk user id bisa lebih dari 1, karna script ini bisa send notif ke beberapa group sesuai user id group yang di berikan\ndan jika script mendeteksi adanya exluded ip, maka script tidak akan mengirimkan notif untuk ip tersebut \u0026hellip; tetapi untuk log tetap tercatat di masing-masing server\n⚠️ Note : jangan tanya user id atau token telegram ke abang bakso kalau tidak mau di lempar kuah panas \u0026hellip; sukur-sukur di lempar ama bakso / gerobaknya 😂 😂\n 3.b) Setup SSH okehh, supaya script ini otomatis mendeteksi ada user login dari SSH / Interactive Shell, script nya harus di pindahin ke folder /etc/profile.d\n\u0026gt; cp login-ssh.sh /etc/profile.d/    4) hasilnya?  nah ini nanti tampilan notif nya, sudah generated hashtag per server secara otomatis juga, jadi akan mudah kalau mau liat history\ndan yang ini log di setiap server yang sudah di pasang script monitoring SSH\n\u0026gt; tail -f /var/log/ssh-login.log [ SSH ] [ 09-Jan-2021 ] [ 15:41:37 ] \u0026gt;\u0026gt; 172.16.100.5 as root ... Notif ERROR 1 [ SSH ] [ 11-Jan-2021 ] [ 09:16:16 ] \u0026gt;\u0026gt; Excluded IP root @ 127.0.0.1 [ SSH ] [ 11-Jan-2021 ] [ 09:16:30 ] \u0026gt;\u0026gt; Excluded IP root @ ::1 [ SSH ] [ 12-Jan-2021 ] [ 11:26:51 ] \u0026gt;\u0026gt; 116.206.40.56 as root ... Notif Success [ SSH ] [ 12-Jan-2021 ] [ 11:29:08 ] \u0026gt;\u0026gt; 116.206.40.56 as root ... Notif Success ","permalink":"https://berrabe.github.io/id/posts/2021/06-jan-2021/telegram-notification-on-ssh-login/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing dikit tentang gimane caranya kasih notif ke tele kalau ada yang login ke server lewat SSH atau interactive shell\n knapa harus ke telegram?  ya karna biar simpel aja gitu sembari chat ama pacar temen, bisa lihat notif server + bisa di buka di manapun (HP, Website, Desktop) dengan cepat tanpa buka WebApp, login dst kayak pake ELK, Grafana Loki dkk","title":"Telegram Notification on SSH Login"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nokehhh \u0026hellip; saya pengen share lagi caranyooo lari dari kenyataan, ehh 😅 \u0026hellip;\nfokusss \u0026hellip; maksudnya cara nge-install gitlab-runner, WUHUUU 😵\n ⚠️ Note : sebelum masuk ke sini, pastikan sudah paham apa itu kultur DevOps, dan istilah-istilah di dalamnya, seperti CI / CD, Pipeline, Build, Deploy, Automation, dll\n  lanjottt , gitlab-runner itu cemilan apaan sih? \u0026hellip;\nbagi yang belum tau / belum pernah dengar, gitlab-runner merupakan cemilan program yang di gunakan untuk menghandle proses automasi kerja yang terjadi pada pipeline di gitlab CI / CD\ndyarrrr \u0026hellip; mumet to ndase 😩 😩\n untuk lebih jelasnya lihat gambar di atas, CI PIPELINE dan CD PIPELINE semua nya butuh gitlab-runner\ndimana runner berfungsi sangat penting agar CI / CD pipeline pada gitlab bisa berjalan, jika tidak ada runner yang aktif / terset, maka job di pipeline status nya akan pause dan stuck / tidak bisa jalan\n   2) Wuuzzzz \u0026hellip;.  okeh, tapi bukannya Gitlab sudah menyediakan runner punya mereka sendiri (shared runner)? , trus kenapa harus install runner punya sendiri?\njawabannya \u0026ldquo;tergantung orangnya\u0026rdquo;, kalo saya install runner sendiri agar proses pipeline bisa lebih cepat di bandingkan shared runner gitlab (namanya juga berbagi) dan untuk alasan keamanan \u0026hellip; yap karna keamanan sangat penting\nwalaupunnnnn shared-runner akan menghapus container saat job selesai, tapi kan kita tidak bisa menjamin 100%, apalagi jika code di repo sangat private dan ada beberapa informasi sensitif di dalamnya (walau bukan best practice)\nhhmmmmm \u0026hellip;. OK, setelah mulut berbusa karna terlalu banyak jelasin, langsung lanjot ae ke praktek setup nya dah 😓\n 2.a) Siomay Docker sebagai executor sebelum masuk ke gitlab-runner nya, install executor dulu\nexecutor itu merupakan makanan tools / metode yang di gunakan gitlab-runner untuk mengeksekusi job di pipeline CI / CD nya, untuk list executor bisa lihat di sini \u0026hellip; saya memilih docker biar isolated dan mudah maintenance\n\u0026gt; curl -fsSL https://get.docker.com -o get-docker.sh \u0026gt; sh get-docker.sh \u0026gt; systemctl start docker  2.b) Install Gitlab-Runner kebetulan saya install gitlab-runner di Debian dengan spec server 48 Core CPU 128 GB RAM \u0026hellip; kenthirrr 😂 😂\nbiar gampang maintenance gitlab-runner nantinya, saya install sebagai package repo saja\n\u0026gt; curl -L \u0026#34;https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh\u0026#34; | sudo bash # Pengguna Debian buster harus disable skel untuk mencegah error No such file atau directory Job failures \u0026gt; export GITLAB_RUNNER_DISABLE_SKEL=true; \u0026gt; sudo -E apt install gitlab-runner anddd \u0026hellip; donee, gimana? gampang to \u0026hellip; cuman 3 baris perintah doang 👍 😎\n⚠️ Note : spec yang di butuhkan menjalankan gitlab-runner + docker sangat kecil \u0026hellip; semakin tinggi semakin bagus\n 2.c) Register Gitlab-Runner Tahap selanjutnya, Gitlab-Runner harus di daftarkan ke Gitlab, agar nantinya Gitlab bisa kenalan dan menggunakan gitlab-runner di server ini\nsebelum itu, dapetin token untuk runner dan URL nya di settings --\u0026gt; CI / CD --\u0026gt; runners\nlangsung masuk ke CLI, buat daftarin runner di server agar bisa nyambung ke gitlab \u0026hellip;\njangan lupa kalo copas sambil di lihat scriptnya 😝 , sesuaikan url dan gitlab-runner token nya\n\u0026gt; gitlab-runner register -n \\ --url \u0026lt; URL \u0026gt; \\ --registration-token \u0026lt; GITLAB-RUNNER TOKEN \u0026gt; \\ --executor docker \\ --description \u0026#34;Mantan Jelek\u0026#34; \\ --docker-image \u0026#34;docker:stable\u0026#34; \\ --tag-list mantan-jelek \\ --request-concurrency 30 \\ --limit 30 \\ --docker-privileged kalau uda, nanti di gitlab akan muncul beginian, menandakan kalau runner di server sudah tersambung ke gitlab dan sudah siap di gunakan oleh CI / CD job\n   3) Mencoba Gitlab-Runner  nah tadi kan uda proses install executor, gitlab-runner sama registrasi nya \u0026hellip; sekarang cara gunain runner nya begimaneeeee ?\nsabarrr \u0026hellip; kasih istirahat otak dulu nape 😪\n 3.a) tagging buat gunain gitlab-runner yang uda di setting tadi, bisa dengan ngasi atribut tags pada file .gitlab-ci.yml di bagian job atribut nya \u0026hellip; contoh nya seperti di bawah di mana tadi saya setting tag runner nya dengan nama mantan-jelek\nbuild: image: docker:latest stage: publish tags: - mantan-jelek services: - docker:dind script: - docker build -t $TAG_COMMIT -t $TAG_LATEST . # push to Gitlab container registry instead of docker hub - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY - docker push $TAG_COMMIT - docker push $TAG_LATEST only: # regex for semantic version (vx.x.x) - /^v([0-9]+)\\.([0-9]+)\\.([0-9]+)$/ except: - branches  3.b) Untagged Jobs cara yang kedua adalah dengan cara aktifkan mode untagged-jobs \u0026hellip; berguna untuk jobs yang tidak punya / tidak di set tags\nkalau opsi ini tidak di aktifkan, maka status pipeline job akan pause stuck (jika shared runner tidak ada / di nonaktifkan)\nuntuk mengaktifkan, tinggal masuk ke settingan runner yang tadi dan centang seperti di gambar\n⚠️ Note : tags di gitlab CI / CD berbeda dengan git tag \u0026hellip; tags di CI / CD di gunakan untuk memilih runner yang di gunakan untuk mengeksekusi job\n   4) TroubleShoot \u0026quot;Cannot Connect to Docker Daemon\u0026quot;?  akhirnyaaa semua sudah berhasil, tetapi saat proses packaging dari source code menjadi docker image, ada error yang terjadi, dimana executor tidak bisa mengkontak socket dari docker-machine API 😱 😱 \u0026hellip;\ncobaan apa lagi ini gustiiiii 😩 😩 \u0026hellip;.\nsetelah bertapaa selama 5 menit, dapat wangsit petunjuk jugaaa 😂\nternyata cara solve nya sangat mudah, tinggal binding docker.sock volume di runner yang telah di set tadi \u0026hellip; edit file /etc/gitlab-runner/config.toml\n[runners.docker] xxx xxx volumes = [\u0026#34;/cache\u0026#34;] xxx tambahkan docker socket di bagian volumes, menjadi\nvolumes = [\u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34;, \u0026#34;/cache\u0026#34;] dan PIPELINE pun berjalan lancarrrr, YEAY 😌\n⚠️ Note : saat menjalankan command gitlab-runner register, konfigurasi akan otomatis di buat pada dir /etc/gitlab-runner/config.toml\n","permalink":"https://berrabe.github.io/id/posts/2021/05-jan-2021/setup-gitlab-runner-docker-executor/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nokehhh \u0026hellip; saya pengen share lagi caranyooo lari dari kenyataan, ehh 😅 \u0026hellip;\nfokusss \u0026hellip; maksudnya cara nge-install gitlab-runner, WUHUUU 😵\n ⚠️ Note : sebelum masuk ke sini, pastikan sudah paham apa itu kultur DevOps, dan istilah-istilah di dalamnya, seperti CI / CD, Pipeline, Build, Deploy, Automation, dll","title":"Setup Gitlab-Runner + Docker Executor"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing lagi bagaimana cara memasak indomie, eh \u0026hellip; maap, efek laperrr 😪\nmaksud saya cara Monitoring, Undervolting dan Tweaking CPU di Linux. Untuk info saja, topik utamanya adalah UNDERVOLTING \u0026hellip; dimana dari undervolting itu nyambung ke tweaking lalu monitoring\nsebelumnya uda tau belom ama undervolt? adeknya overclock itu lhooo, anak nya pak RT 😌 \u0026hellip; klo blom, saya kasih tauu \u0026hellip;\n   2) Adek Kakak?  Penjelasan OverClock dan UnderVolt secara garis besar, biar ga salah paham \u0026hellip; beda kaya jelasin ke doi, selaluuuuu aja salah, hiks hiks 😩\n 2.a) OverClocking jadi gini, di dunia per-hardware an ini, ada istilah yang sering kali di ucapkan, baik oleh para gamers, Antusias PC, Editor, dll \u0026hellip; yaitu OVERCLOCKING, dimana overclocking ini akan menaikkan clock dari CPU, misal dari 2 ke 5 GHz dengan syarat dan ketentuan berlaku 😎\njika clock CPU naik, kecepatan komputasi dari sebuah CPU akan menjadi lebih cepat, jadi semisal, ada editor rendering video 4k 30 detik di clock 2 GHz membutuhkan waktu 15 menit lebih, maka kalau di 5 GHz hanya 5 menit atau kurang\nsangat lumayan bukan? \u0026hellip; brati saya sekarang bisa beli CPU harga 3-4 jutaan yang akan menyaingi CPU harga 6 jutaan ke atas, YEAYY 😀\n 2.b) UnderVolting tadi saya sudah menjelaskan OverClocking secara garis besar, sekarang apa itu UndverVolting?\ngampangnya, undervolting itu kebalikan dari overclocking \u0026hellip; jadi, klo overclocking itu Voltase CPU nya di naikkan agar Clock CPU nya bisa naik\nnah klo undervolt, Voltase CPU nya di turunkan, supaya apa? \u0026hellip; bisa banyak, coba lanjut baca dulu, nanti saya suapin, eh \u0026hellip; jelasinnn 😋\n 2.c) Kelebihan dan Kekurangan kelebihan dan kekurangan secara garis besar antara OverClocking dan UnderVolting \u0026hellip; bukan antara kamu dan dia, yhaaa 😜\n   Metric OverClocking UnderVolting     CPU Voltase / Vcore Naik Turun   CPU Clock Naik Tetap / di Turunkan   Suhu CPU Semakin Tinggi Stabil / Semakin Rendah   Performa CPU Naik Tetap / Turun   Listrik Boros Stabil / Hemat   Baterai Boros Irit   Umur CPU Berkurang Awet   Biaya Mahal / Ada Biaya Tanpa Biaya    sudah paham kan gambaran antara OverClocking dan UnderVolting secara umum \u0026hellip; ingat secara umum tujuan dari 2 metode diatas seperti itu, tapi balik lagi ke Tweaker / OverClocker nya\n   3) UnderVolting!!!  kalau di windows, banyak sekali tools untuk overclocking / undervolting, contoh nya untuk CPU Intel ada ThrottleStop, Intel Xtreme Utility dsb. Untuk AMD Ryzen ada AMD Ryzen Master dsb\ndi linux, hanya ada beberapa yang terkenal dan sering di gunakan, yaitu Python Undervolt \u0026hellip; di buat menggunakan bahasa python, dokumentasi lengkap nya bisa di lihat di sini\n 3.a) Persiapan UnderVolting cara install dan makai nya sangat-sangat gampang, yang di butuhkan adalah\n Python v3.x Python3-pip CPU Intel \u0026gt;= Gen 4 (Haswell) Gebetan 😂  # install undervolt \u0026gt; sudo pip3 install undervolt # testing pembacaan CPU Voltase / Vcore \u0026gt; sudo undervolt --read temperature target: -1 (99C) core: 0.0 mV gpu: 0.0 mV cache: 0.0 mV uncore: 0.0 mV analogio: 0.0 mV powerlimit: 46.25W (short: 0.00244140625s - enabled) / 37.0W (long: 28.0s - enabled) [locked] ⚠️ Note : Jika proses read gagal, di karenakan tidak semua CPU bisa di undervolt, ada beberapa CPU yang tidak di dukung karna driver CPU nya atau faktor lainnya\n 3.b) Core of The Core Cara UnderVolting itu sangat mudah sekali, seng penting yaqqinnnn 😂\ntapi serius, tidak ada rumus pasti untuk menentukan angka batas / offset, karna setiap CPU itu bisa berbeda walaupun versi / seri nya sama, dan karna saya sudah pernah coba-coba di windows menggunakan aplikasi ThrottleStop dan Intel Extreme Utility, maka angka offset nya tinggal saya aplikasikan di Python Undervolt linux ini\n\u0026gt; sudo undervolt \\ --core -165 \\ --cache -165 \\ --gpu -135 \\ --uncore -165 \\ --analogio -165 \u0026gt; sudo undervolt --read temperature target: -1 (99C) core: -165.04 mV gpu: -134.77 mV cache: -165.04 mV uncore: -165.04 mV analogio: -165.04 mV powerlimit: 46.25W (short: 0.00244140625s - enabled) / 37.0W (long: 28.0s - enabled) [locked] sudah selesaiii \u0026hellip; gampang kann??? kalo ada yang bilang susah, harus di ruqyah tu kayaknyaaa 😤\n   4) Monitoring Mantan  woke sekarang saatnya monitoring Mantan CPU nya, di sini saya membuat tools nya sendiri \u0026hellip; bisa di lihat di sini\n 4.a) Installing Mantan sekali lagi, cara install dan pakai nya sangat mudah, pastikan package lm_sensors dan git sudah terinstall\n# Install Package Pendukung \u0026gt; sudo pacman -S lm_sensors git # Install CPU-UTIL \u0026gt; git clone https://github.com/berrabe/cpu-util.git \u0026gt; cd cpu-util \u0026gt; sudo cp cpu-util /usr/bin/ ⚠️ Note : FYI untuk cpu-util ini bukan hanya untuk monitoring, tapi bisa untuk scaling frequency dan non-aktifkan multi-threading + booster \u0026hellip;\n 4.b) CPU Freq Scaling Scaling CPU Frequency ini tidak wajib, tapi saya selalu menggunakannya agar hasil UnderVolt lebih maksimal\n\u0026gt; cpu-util -sf 1000000 Core 0 =\u0026gt; 1,000,000 MHz Core 1 =\u0026gt; 1,000,000 MHz Core 2 =\u0026gt; 1,000,000 MHz Core 3 =\u0026gt; 1,000,000 MHz Core 4 =\u0026gt; 1,000,000 MHz Core 5 =\u0026gt; 1,000,000 MHz Core 6 =\u0026gt; 1,000,000 MHz Core 7 =\u0026gt; 1,000,000 MHz ⚠️ Note : Semakin Rendah CPU Frequency, maka nilai offset undervolt juga bisa di rendahkan \u0026hellip; semisal di angka 2.5 GHz sebesar -100 mV, maka setelah di UnderClock ke 800 MHz bisa di set ke -150 mV\n 4.c) Keadaan Mantan CPU? oke, saatnya menjalankan mode monitoring\n\u0026gt; cpu-util -mo [ Monitoring ] [ 15:16:18 ] [+] OS Info | |-[+] Proc Intel(R) Core(TM) i7-4702MQ CPU @ 2.20GHz |-[+] Uptime 5 hours, 1 minute |-[+] Host Lenovo IdeaPad Z410 |-[+] Kernel 5.4.85-1-MANJARO |-[+] Arch Manjaro Linux x86-64 [+] Sys Info | |-[+] cpu 6.11 % |-[+] Driver intel_pstate |-[+] Gov performance - powersave |-[+] Mem 2197 MB / 5701 MB |-[+] Core 8 / 8 Cores |-[+] Stats 976.873 MHz 39.0 °C 984.844 MHz 39.0 °C 997.397 MHz 37.0 °C 997.473 MHz 39.0 °C 997.428 MHz 985.895 MHz 997.461 MHz 989.919 MHz sudah terlihat, informasi basic dari linux saya dan prosesor nya \u0026hellip; dan bisa di lihat juga suhu prosesor saya, rerata hanya 39.0 °C !! \u0026hellip;\nini posisi intel i7 yang haus power, dan posisi lagi buka banyak tab firefox bejibun (lihat penggunaan ram), Ngetik, Coding, Dengerin Spotify dsb\nUnderVolting itu Worth It Bukan?\n   5) CPU Jadul / Non-Intel?  oke, semua hasil sudah terlihat, dan menurut saya UnderVolt itu sangat worth it \u0026hellip; karna banyak maanfaatnya, paling kerasa di suhu CPU, penggunaan baterai dan nantinya berimbas ke keawetan CPU itu sendiri 😎\ntapi masalahnya metode ini hanya berlaku untuk intel generasi terbaru \u0026gt;= Gen 4 / Haswell, tapi bagaimana jika intel di bawah Gen 4 atau CPU AMD?\n Intel Di Bawah Gen 4  saya dulu pernah mencoba pada prosesor Intel Core 2 Duo di laptop VAIO VGN-Z46GD tahun 2008 menggunakan Intel PHC, bisa di lihat di sini. dengan driver CPU lama acpi_cpufreq di bandingkan yang sekarang Intel P-states\ntapi menurut saya, Intel PHC tidak cukup powerful karna tidak bisa melakukan UnderVolting di bawah 0 mV (offset tidak bisa minus), sehingga hasil nya terasa kurang maksimal\n Processor AMD  untuk processor AMD jujur saja saya belum pernah coba, tapi bila membaca dokumentasi dari tools Python3 Undervolt dan Intel PHC. tools-tools ini bisa melakukan nya dengan lancar tanpa ada kendala, syarat dan ketentuan berlaku 😊\n","permalink":"https://berrabe.github.io/id/posts/2021/04-jan-2021/monitoring-undervolting-and-tweaking-cpu-on-top-linux/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing lagi bagaimana cara memasak indomie, eh \u0026hellip; maap, efek laperrr 😪\nmaksud saya cara Monitoring, Undervolting dan Tweaking CPU di Linux. Untuk info saja, topik utamanya adalah UNDERVOLTING \u0026hellip; dimana dari undervolting itu nyambung ke tweaking lalu monitoring\nsebelumnya uda tau belom ama undervolt?","title":"Monitoring, Undervolting and Tweaking CPU on Top Linux"},{"content":"  1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing dikit \u0026hellip; suatu hari, saya di suruh ganti password server + setting SSH-Key yang akan di lakukan rutin setiap bulan, untuk alasan keamanan\nmasih oke lahhhh, ganti gitu doanggg 😙 \u0026hellip;\neits, tapi masih belum selesai, ternyata server nya kagak cuman atuu, tapi puluhan server \u0026hellip; WHAT!?, lebih tepat nya 40 server per bulan ini yang akan bertambah lagi seiring pertambahan client\nFYI, beberapa block server di tempatkan pada DC (Data Center) yang berbeda dengan kebijkan firewall berbeda pula, dan tidak semua server punya IP PUBLIC \u0026hellip; MAMPOSSSHHHH 😱\nmulai mikir nih, klo ganti manual tangan saya tekor kaga yak, dan butuh berapa lama? belum lagi klo kagak berhasil karna beberapa faktor, seperti human error\ndan di tambah lagi, semua ini di lakukan perbulan!! 😭\n   2) Mencari Solusi Tanpa Solusi 😅  okeh .. singkat cerita akhirnya saya nemu makanan namanya Ansible \u0026hellip; eh bukan makanan deng, tapi tools 😅\nkarna tadi ngobrol ama ansible nya cuman bentar, jadi saya crita tentang doi dikit aje ye, selebihnya bisa cari di dokumentasi, artikel, dll \u0026hellip;\nsingkatnya, doi merupakan tools yang di gunakan untuk meng-automasi kerjaan kita terkait maintenance hardware di IT (Server, Router, Switch, dll)\nautomasi nya kek mana? yaaaa seperti ganti password, konfigurasi server / router, deploy script dll \u0026hellip; pokoknya semua hal yang kita lakukan secara manual menggunakan CLI (Command Line Interface) lewat SSH (Secure Shell) bisa di lakukan ama doi secara otomatis \u0026hellip; aji gile, gokil benerrr 😵\n   3) Syarat Untuk nikah Memakai?  Syarat untuk memakai si Ansible sangat mudah, yang penting punya:\n Laptop / Komputer SSH + SSH-Key Python v2.x / v3.x VPN PACAR  laptop / komputer itu sebagai \u0026ldquo;OTAK\u0026rdquo; yang akan mengatur semua server-server tadi .. kebetulan server-server yang akan saya remote basis nya CentOS dan Debian, jadi semua sudah otomatis terinstall SSH dan Python v2.x secara default\nsoooo, saya hanya butuh install Ansible aja sebagai \u0026ldquo;OTAK\u0026rdquo; di LAPTOP Saya\nFYI, di karenakan server-server ini berbeda tempat + berbeda password, maka saya login atu-atu dulu ke semua server buat nyetting SSH-Key punya saya, biar klo login kaga usah ngetik password + saya juga setting VPN, tepatnya OpenVPN di setiap server, agar konek nya gampang, dan maintenance list server nya mudah (satu network)\n   4) Caranya?  okehh, lanjottt ke cara make si Ansible nya kek manaaa? \u0026hellip; sabar sodara-sodara, mikir kalimat nya dulu ini, emang gampang apa nulis beginian 😑\n 4.a) Install si Otak Karna Laptop saya menggunakan Linux (Arch-Based), maka cara install nya tinggal pakai paket manager saja \u0026hellip; untuk yang tidak sama, bisa ikutin caranyee di dokumentasi resminya\n\u0026gt; pacman -S ansible  4.b) Konfigurasi Masuk ke tahap konfig, mari kita buat simple\n\u0026gt; mkdir skidipapap \u0026gt; cd skidipapap \u0026gt; touch hosts.yml \u0026amp;\u0026amp; touch 01-passwd.yml  4.b.I) Konfigurasi - hosts Nah, kan saya mau automasi ke server-server nih, saya harus ngasih tau dulu si Ansible, server nya yang mane ajee \u0026hellip; kan doi belum pernah kenalan, kesian ntar malah salah masuk server, kan jadi berrabe\nisi ke file hosts.yml seperti di bawah, ganti x.x.x.x menjadi ip server\n--- all: hosts: x.x.x.x x.x.x.x x.x.x.x # dst vars: ansible_user: root ansible_python_interpreter: /usr/bin/python  4.b.I) Konfigurasi - Otak Oke, sekarang bagian terpenting, saya akan setting logic automasi nya \u0026hellip; isi ke file 01-passwd.yml\n--- - name: CHANGE PASSWORD ALL SERVER hosts: \u0026#39;all\u0026#39; gather_facts: no tasks: - name: PING ping: - name: SET / DELETE SSH-KEY WITH BLOCK blockinfile: path: /root/.ssh/authorized_keys state: present marker: \u0026#34;# {mark} SSH Public Key, reset every month | DO NOT DELETE THIS BLOCK !!!\u0026#34; block: \u0026#34;{{ lookup(\u0026#39;file\u0026#39;, \u0026#39;$HOME/.ssh/authorized_keys\u0026#39;) }}\u0026#34; # block: \u0026#34;ssh-rsa xxxxxxxxx ...\u0026#34; - name: CHANGE ROOT PASSWORD user: name: root update_password: always password: \u0026#34;{{ password|password_hash(\u0026#39;sha512\u0026#39;) }}\u0026#34; FYI, jika setting manual biasanya menggunakan command CLI Linux, di Ansible berbeda \u0026hellip;\nAnsible menggunakan module yang isinya berupa script python (makanya server butuh terinstall python), yang akan di kirimkan dari si OTAK (Client) ke server-server \u0026hellip; jika sudah di kirimkan, script python tadi akan di eksekusi\ntiap module berbeda cara penggunaan, tinggal baca dokumentasi terkait module apa yang akan di gunakan (misal modul user untuk membuat / mengganti / menghapus informasi suatu user di Linux)\n 4.c) Ngengggg \u0026hellip; wokai, gampang kan konfigurasi nya? langkah terakhir yaitu jalanin si ansible ini \u0026hellip; cukup 1 baris perintah\n\u0026gt; ansible-playbook 01-passwd.yml -e \u0026#39;password=berrabe_ganteng\u0026#39; -i hosts-yml -f 40    4) Kesimpulan  huahhhh \u0026hellip; setelah 5 menit konfig ansible + 3 jam setting ssh-key, setting vpn, tshoot di puluhan server \u0026hellip; selesai juga ni kerjaan 💪\nhasilnya akan seperti ini\nPLAY [CHANGE PASSWORD ALL SERVER] TASK [PING] ok: [x.x.x.x] ok: [x.x.x.x] ok: [x.x.x.x] TASK [SET / DELETE SSH-KEY WITH BLOCK] changed: [x.x.x.x] changed: [x.x.x.x] changed: [x.x.x.x] TASK [CHANGE ROOT PASSWORD] changed: [x.x.x.x] changed: [x.x.x.x] changed: [x.x.x.x] PLAY RECAP x.x.x.x : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 x.x.x.x : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 x.x.x.x : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 hhmmm, gampang kan?\nBTW, saya konfigurasi manual untuk ganti password, setup ssh-key dan troubleshoot nya BUTUH 3 JAM AN \u0026hellip; belum ditambah ama kepala pusing, mata merah, laper, ngantuk, leher pegel, ga punya pacar, eh \u0026hellip; dan ini akan terulang setiap bulan, pfttt 😪\ndan coba bandingkan menggunakan Ansible, dengan kemudahan yang doi punya, hanya butuh 5 - 30 menit untuk konfigurasi, tinggal search module nya apa (misalkan user dan blockinfile), saya bisa ganti password + setting SSH-Key dalam waktu 5 menit ke puluhan server\njadi saya tidak perlu lagi meluangkan waktu 3 jam an setiap bulan hanya untuk konfigurasi server perihal pergantian password dan setup SSH-Key. 😎\n","permalink":"https://berrabe.github.io/id/posts/2021/03-jan-2021/automation-for-changing-server-password-and-setup-ssh-key-to-dozens-of-servers/","summary":"1) TLDR  tet tet tetttt \u0026hellip; balek lagi sama saya, berrabe \u0026hellip; dimana saya suka memecahkan masalah menjadi masalah lagiii, YEAY 😎\nkali ini saya pengen sharing dikit \u0026hellip; suatu hari, saya di suruh ganti password server + setting SSH-Key yang akan di lakukan rutin setiap bulan, untuk alasan keamanan\nmasih oke lahhhh, ganti gitu doanggg 😙 \u0026hellip;\neits, tapi masih belum selesai, ternyata server nya kagak cuman atuu, tapi puluhan server \u0026hellip; WHAT!","title":"Automation For Changing Server Password and Setup SSH-Key to Dozens Of Servers"},{"content":"  1) TLDR  yo yo yo eee teammm \u0026hellip; welcome bek to my webseettt 😧 \u0026hellip; selamat pagi, siang atau malam buat temen2, om, tante, pakdhe, budhe, simbah kakung, simbah putri dan semuanya dah 😪\nkali ini saya akan mendokumentasikan gimaneee caranyee setting banyak openvpn dalam satu server.\nMungkin kalian pernah berfikir untuk bypass limitasi yang di lakukan oleh pihak Vendor / ISP kan? semisal Vendor / ISP kalian tidak bisa buka reddit, netplik, skidipapap huahuahua, dsb. sudah coba pakai OpenVPN default (port 1194/UDP) malah ndak bisa connect juga OpenVPN nya (Vendor Kampret)\natau kalian punya server di Data Center yang Vendor Internetnya mem-block semua port dan protokol default VPN?\noke oke, seperti biasaaa \u0026hellip; jangan tenang dan tetap panik 😙 karna kita akan bahas caranye, cekidot\n   2) Setting Dan Install OpenVPN (Mau Ribet / Engga?)  pastinya ni ye, sebelum gunain OpenVPN Client, pasti harus punya OpenVPN Server nya dulu. Untuk itu saya nawarin nih.\nmau yang cara install nya gampang ape susah, kalau gampang, silahkan gunakan script otomasi seperti dari bang angristan atau dari bang Nyr. Atau mau yang susah / install sendiri dari awal, bisa di cari sendiri tutor nya di google, ade bejibun, biasanya dari DigitalOcean \u0026hellip; sampe bilang kaga ada gw jitak lu 😇\nkebetulan saya pakai punya nya bang angristan (Fork dari Nyr), karna lebih mudah aje gitu, tinggal enter2, ikutin settingan default \u0026hellip; kalau internet server nya cepet, 5 menit selesai dan bisa langsung di pakai (lebih lengkap nya lihat dokumentasi github angristan OpenVPN)\n pastikan akfitkan port forwarding / DMZ jika OpenVPN server di bawah jaringan NAT\n    3) Caranya Multiple Port / Protokol?  Wokehh, setelah installasi OpenVPN server yang saya yakin uda pada bisa, tinggal ikutin tutorial doang, copy / paste beres, tutorial pakai bahasa inggris? tinggal translate 😃\nkita akan lanjutkan bagaimana caranya buat multiple ports dan protokol, saya menggunakan script angristan, jika tidak sama bisa di sesuaikan karna tidak beda jauh\n 3.a) Konfigurasi OpenVPN Server sebagai contoh, saya akan buat server OpenVPN baru di port 443/TCP dari settingan default angristan (1194/UDP). Login ke OpenVPN Server menggunakaan SSH\n copy / duplicate server.conf di folder /etc/openvpn/  \u0026gt; cd /etc/openvpn \u0026gt; ls | grep -E \u0026#34;server.*.conf$\u0026#34; -rw-r--r-- 1 root root 696 Dec 17 07:27 server.conf \u0026gt; cp server.conf server_tcp.conf edit file server_tcp.conf, sesuaikan seperti di bawah  # setting port, protokol port 443 proto tcp # setting Network OpenVPN Server server 172.16.111.0 255.255.255.0 # non-aktifkan static ip # ifconfig-pool-persist ipp.txt # setting log file untuk mode 443/TCP status /var/log/openvpn/status_tcp.log tambahkan rule masqurade agar network OpenVPN (172.16.111.x/24) dapat akses ke internet (interface eth0 / WAN)  iptables -t nat -A POSTROUTING -s 172.16.111.0/24 -o eth0 -j MASQUERADE Buat Config untuk Client, terserah namanya apa, format xxx.ovpn dan aktifkan OpenVPN server TCP tadi  \u0026gt; ./openvpn-install.sh \u0026gt; systemctl start openvpn@server_tcp \u0026gt; systemctl enable openvpn@server_tcp  3.a) Konfigurasi OpenVPN Client karna multi ports dan protkol tidak di dukung secara default oleh script angristan, maka saya akan modifikasi config auto-generated dari file openvpn-install.sh yang sudah di buat pada point 4 di atas\n pertama edit config file xxx.ovpn, ganti 4 baris teratas menjadi seperti di bawah  client proto tcp # explicit-exit-notify remote \u0026lt;ip openvpn server\u0026gt; 443 pindah xxx.ovpn ke client dan jalankan filenya  \u0026gt; sudo openvpn xxx.ovpn 2021-01-05 12:54:48 OPTIONS IMPORT: adjusting link_mtu to 1626 2021-01-05 12:54:48 OPTIONS IMPORT: data channel crypto options modified 2021-01-05 12:54:48 Outgoing Data Channel: Cipher \u0026#39;AES-128-GCM\u0026#39; initialized with 128 bit key 2021-01-05 12:54:48 Incoming Data Channel: Cipher \u0026#39;AES-128-GCM\u0026#39; initialized with 128 bit key 2021-01-05 12:54:48 TUN/TAP device tun0 opened 2021-01-05 12:54:48 net_iface_mtu_set: mtu 1500 for tun0 2021-01-05 12:54:48 net_iface_up: set tun0 up 2021-01-05 12:54:48 net_addr_v4_add: 172.16.111.2/24 dev tun0 2021-01-05 12:54:48 Initialization Sequence Completed  OpenVPN sudah berhasil connect ke OpenVPN server dengan protokol TCP port 443\n jika sudah berhasil, bisa kita buat service agar jalan secara otomatis  \u0026gt; cp xxx.ovpn /etc/openvpn/client/xxx.conf \u0026gt; sudo systemctl start openvpn-client@xxx \u0026gt; sudo systemctl enable openvpn-client@xxx    4) Terakhir  Gimane, simpel kan? cuman modifikasi beberapa baris aja dari config default bang angristan aja uda bisa setup OpenVPN server Multiple Port dan Protokol.\nGa cuman 2 OpenVPN Server doang, tapi bisa ratusan 😂, yang penting port nya cukup dan ga susah maintenance nantinya.\nUntuk port TCP/443 merupakan port teraman, karna port ini di gunakan oleh sejuta umat untuk akses website HTTPS \u0026hellip; di jamin Vendor tidak akan blocking 😋 bakal di amuk se RW entar \u0026hellip; kalaupun di block secara analisis packet data, kaga bisa, kan di encrypt 😂\n","permalink":"https://berrabe.github.io/id/posts/2021/02-jan-2021/openvpn-multiple-ports-and-protocol/","summary":"1) TLDR  yo yo yo eee teammm \u0026hellip; welcome bek to my webseettt 😧 \u0026hellip; selamat pagi, siang atau malam buat temen2, om, tante, pakdhe, budhe, simbah kakung, simbah putri dan semuanya dah 😪\nkali ini saya akan mendokumentasikan gimaneee caranyee setting banyak openvpn dalam satu server.\nMungkin kalian pernah berfikir untuk bypass limitasi yang di lakukan oleh pihak Vendor / ISP kan? semisal Vendor / ISP kalian tidak bisa buka reddit, netplik, skidipapap huahuahua, dsb.","title":"Openvpn Multiple Port and Protocol"},{"content":"  1) Masalah Besar pada OpenVPN  Saat saya menginstall openvpn dari script automasi bang angristan (fork dari script Nyr), saya bisa setup server openvpn dengan cepat (hanya 5 menit) dan langsung work, tanpa harus setting cert, ip, routing dll secara manual\ntapi ada satu masalah yang sangat simple tetepi membahayakan, dimana saya tidak bisa akses server client yang terkonek dengan jaringan OpenVPN!!!!, semua service tidak bisa di akses, mulai dari ping, ssh, sftp, webserver, dll \u0026hellip; oke oke, jangan tenang tetap panik 😝\n masalah ini terjadi pada server yang melewatkan semua trafik nya melalui jaringan OpenVPN terlebih dahulu baru ke internet (redirect-gateway def1 bypass-dhcp)\n    2) Masalah Itu di Selesaikan, Bukan Di Hindari  Oke pertama kita lihat dimana masalah nya, kita analisa atu-atu, pokoknya pantang tidur sebelum solved 😴, biar simple \u0026hellip; saya analisa trafik dari service webserver saja, untuk service lain (ssh, sftp, ftp dll) sama saja kok prinsip nya\n 2.a) Alur Paket Web (Standar) pertama kita harus tahu bagaimana sebuah trafik / lalu lintas paket itu bekerja ketika kita mengakses sebuah website dari sudut pandang client / end-user\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | \u0026lt;----+ | | +----------+ +------------+ +--------------+ wewww, grafik yang sangat simpel bukan? saya kasih log web server nih, biar agak detail dikit 😅\n180.254.92.138 - - [04/Jan/2021:09:57:29 +0000] \u0026#34;GET / HTTP/1.1\u0026#34; 200 612 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (X11; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0\u0026#34; \u0026#34;-\u0026#34; 180.254.92.138 - - [04/Jan/2021:09:57:30 +0000] \u0026#34;GET /favicon.ico HTTP/1.1\u0026#34; 404 153 \u0026#34;http://36.80.241.251/\u0026#34; \u0026#34;Mozilla/5.0 (X11; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0\u0026#34; \u0026#34;-\u0026#34; okehhh, perlu di inget dulu ye, ip public saya adalah 180.254.92.138 (sama seperti yang ada di log). Brati kalo saya simpulkan, cara kerja web server itu, dia akan mengembalikan request sesuai alamat ip client yang meminta.\nJadi semisal ip public saya 180.254.92.138 melakukan request ke google, ya google akan ngembaliin request ke ip public komputer saya, yaitu 180.254.92.138 \u0026hellip; bukannya ke ip 2.2.2.2 punyanya komputer pak RT 😂\n 2.b) Alur Paket Web (OpenVPN) okeh bosq, sekarang kita uda tau bagaimana paket web standar itu bekerja, trus sekarang kita lihat trafik yang menggunakan OpenVPN kenapa tidak bekerja 😢\nmari kita lihat grafik nya\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ jika di lihat sekilas, seharusnya tidak ada masalah bukan? request dari client menuju web server, kemudian di kembalikan ke client, Normal and Simpel \u0026hellip; Hanya saja sebelum di kembalikan ke client, trafik di lewatkan ke jaringan OpenVPN terlebih dahulu\neits, tidak semudah itu ferguso \u0026hellip; kenyatannya trafik request dari client tidak sampai / balik lagi ke client alias PUTUS, trafik ini berlaku tidak hanya untuk service web, tapi semua service dari ssh, sftp, ftp dll\n 2.c) Masalah nya tu disini \u0026hellip;. Intinya, saat client mengakses service (ping, ssh, web server, dll) di server yang semua traffik nya ter-redirect / dilewatkan ke OpenVPN, trafik tidak bisa kembali lagi ke client. Nah Loh 😱\nDari pada vusing dan ngawang knape bisa gitu, mari kita analisis secara mendalam menggunakan wireshark-cli / tshark. Untuk mempermudah pengecekan, kita akan menggunakan protokol icmp / ping \u0026hellip; klo pake http ribet cyinn (ngelesss) 😬\ntapi sebelum itu, kita harus tahu trafik ping yang normal itu seperti apa\n\u0026gt; ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. 64 bytes from 1.1.1.1: icmp_seq=1 ttl=55 time=29.6 ms 64 bytes from 1.1.1.1: icmp_seq=2 ttl=55 time=30.6 ms # wireshark-cli Capturing on \u0026#39;wlp9s0\u0026#39; 1 0.000000000 180.254.92.138 → 1.1.1.1 ICMP 98 Echo (ping) request id=0x0016, seq=1/256, ttl=64 2 0.028321186 1.1.1.1 → 180.254.92.138 ICMP 98 Echo (ping) reply id=0x0016, seq=1/256, ttl=55 (request in 1) 3 1.001599961 180.254.92.138 → 1.1.1.1 ICMP 98 Echo (ping) request id=0x0016, seq=2/512, ttl=64 4 1.045006664 1.1.1.1 → 180.254.92.138 ICMP 98 Echo (ping) reply id=0x0016, seq=2/512, ttl=55 (request in 3) okeh, traffik yang sangat sederhana, dimana saya sebagai client (180.254.92.138) melakukan ping (request) ke cloudflared (1.1.1.1) dan di balas dengan paket (reply)\nsekarang mari kita lihat trafik saat kita ping server yang semua traffic nya ter-redirect melewati OpenVPN\n\u0026gt; ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. # wireshark-cli Capturing on \u0026#39;wlp9s0\u0026#39; 1 0.000000000 180.254.92.138 → 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=1/256, ttl=54 2 1.169998179 180.254.92.138 → 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=2/512, ttl=54 3 2.036470879 180.254.92.138 → 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=3/768, ttl=54 loh loh, kok command ping nya stcuk dan paket nya request saja? tidak ada balasan / reply? seperti cinta bertepuk sebelah tangan bukan? 😛\n   3) Menyelesaikan Masalah Tanpa Solusi  setelah mencari wangsit dari sabang sampai merauke, akhirnya saya dapat akar masalahnya 😂 .. sebelum itu mari kita lihat grafik trafik sekali lagi\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ jika kita amati di Web Server, kita bisa lihat bahwa jalur trafik masuk dan keluar itu berbeda bukan? katakanlah masuk lewat pintu depan dan keluar lewat jendela\nperlu di ingat bahwa komputer hanya malayani trafik default, di mana trafik masuk dan keluar lewat pintu depan \u0026hellip; Tapi jangan putus asa dulu, mau tahu cara solved nya? jangan kasi kendor, baca terus sampai bawah 😊\n 3.a) Skenario 1 sebelum mulai, kita lihat gambaran skema trafik flow dari skenario 1 ini\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | \u0026lt;----+ | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ secara garis besar tidak ada perubahan, tetapiiii jika kita perhatikan di Web Server, ada panah bolak-balik yang menandakan, trafik client yang masuk pintu depan, akan kita balikkan ke pintu depan lagi dari pada kita redirect / alihkan melalui jendala (OpenVPN)\ntraffic di atas bisa di lakukan dengan routing ke arah ip public client yang mengakses server\n\u0026gt; ip route add \u0026lt; ip public client \u0026gt; dev \u0026lt; interface WAN server \u0026gt; # Contoh \u0026gt; ip route add 1.1.1.1 dev eth0  kekurangan dari solusi ini adalah kita harus routing satu2 public ip client yang ingin terhubung / akses ke server\n  3.b) Skenario 2 skenarion ke 2 ini akan tetap mempertahankan skema awal trafic, dimana trafik masuk dari pintu depan (eth0 WAN Internet) dan keluar melalui jendela (tun0 - OpenVPN) dengan menggunakan chain filter dan nat masqurade. Untuk skema trafik nya seperti di bawah ini\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ semua bisa di lakukan dengan cara\n# ipv4 forward \u0026gt; sysctl -w net.ipv4.ip_forward=1 # accept forward chain \u0026gt; iptables -A FORWARD --in-interface eth0 -j ACCEPT # masking ip (NAT) after routing process \u0026gt; iptables --table nat -A POSTROUTING --out-interface tun0 -j MASQUERADE  kekurangan dari solusi ini adalah, tidak semua service akan berhasil. karena akan di anggap sebagai serangan MITM / spoofing. dimana kita meminta (request) ke server ip 1.1.1.1 tapi yang membalas (reply) adalah server ip 5.5.5.5\n  3.c) Skenario 3 ada 2 skenario terakhir dan ini solusi yang recommended menurut saya, yaitu\n Pertama, non-aktifkan redirecting all traffic  berguna agar tidak semua traffic di lewatkan OpenVPN, hanya network ip tertentu saja yang di lewatkan. Delete / Comment baris seperti di bawah    # redirect-gateway def1 bypass-dhcp  Kedua, jika ingin tetap melewatkan semua trafic melewati jaringan OpenVPN, gunakan fitur packet marking yang ada di iptables\n rule ini berfungsi untuk menandai setiap packet yang masuk ke server. Yang mana nantinya packet response akan melewati jalan di mana packet tersebut masuk.  sebagai contoh, jika kita masuk lewat pintu depan, maka saat kita keluar, server akan mengarahkan lewat pintu depan juga, tidak lewat jendela seperti sebelumnya\n  untuk point 2 explore sendiri yeee, ribet cyin soalnyeee \u0026hellip; nih link nya 😂\n","permalink":"https://berrabe.github.io/id/posts/2021/01-jan-2021/openvpn-redirect-problem/","summary":"1) Masalah Besar pada OpenVPN  Saat saya menginstall openvpn dari script automasi bang angristan (fork dari script Nyr), saya bisa setup server openvpn dengan cepat (hanya 5 menit) dan langsung work, tanpa harus setting cert, ip, routing dll secara manual\ntapi ada satu masalah yang sangat simple tetepi membahayakan, dimana saya tidak bisa akses server client yang terkonek dengan jaringan OpenVPN!!!!, semua service tidak bisa di akses, mulai dari ping, ssh, sftp, webserver, dll \u0026hellip; oke oke, jangan tenang tetap panik 😝","title":"Openvpn Redirect Problem"},{"content":"","permalink":"https://berrabe.github.io/id/archives/","summary":"archives","title":"Archive"},{"content":"","permalink":"https://berrabe.github.io/id/search/","summary":"","title":"Pencarian"}]