[{"content":"Â Â 1) TLDR  yo yo yo eee teammm \u0026hellip; welcome bek to my webseettt ğŸ˜§ \u0026hellip; selamat pagi, siang atau malam buat temen2, om, tante, pakdhe, budhe, simbah kakung, simbah putri dan semuanya dah ğŸ˜ª\nkali ini saya akan mendokumentasikan gimaneee caranyee setting banyak openvpn dalam satu server.\nMungkin kalian pernah berfikir untuk bypass limitasi yang di lakukan oleh pihak Vendor / ISP kan? semisal Vendor / ISP kalian tidak bisa buka reddit, netplik, skidipapap huahuahua, dsb. sudah coba pakai OpenVPN default (port 1194/UDP) malah ndak bisa connect juga OpenVPN nya (Vendor Kampret)\natau kalian punya server di Data Center yang Vendor Internetnya mem-block semua port dan protokol default VPN?\noke oke, seperti biasaaa \u0026hellip; jangan tenang dan tetap panik ğŸ˜™ karna kita akan bahas caranye, cekidot\nÂ Â Â 2) Setting Dan Install OpenVPN (Mau Ribet / Engga?)  pastinya ni ye, sebelum gunain OpenVPN Client, pasti harus punya OpenVPN Server nya dulu. Untuk itu saya nawarin nih.\nmau yang cara install nya gampang ape susah, kalau gampang, silahkan gunakan script otomasi seperti dari bang angristan atau dari bang Nyr. Atau mau yang susah / install sendiri dari awal, bisa di cari sendiri tutor nya di google, ade bejibun, biasanya dari DigitalOcean \u0026hellip; sampe bilang kaga ada gw jitak lu ğŸ˜‡\nkebetulan saya pakai punya nya bang angristan (Fork dari Nyr), karna lebih mudah aje gitu, tinggal enter2, ikutin settingan default \u0026hellip; kalau internet server nya cepet, 5 menit selesai dan bisa langsung di pakai (lebih lengkap nya lihat dokumentasi github angristan OpenVPN)\n pastikan akfitkan port forwarding / DMZ jika OpenVPN server di bawah jaringan NAT\n Â Â Â 3) Caranya Multiple Port / Protokol?  Wokehh, setelah installasi OpenVPN server yang saya yakin uda pada bisa, tinggal ikutin tutorial doang, copy / paste beres, tutorial pakai bahasa inggris? tinggal translate ğŸ˜ƒ\nkita akan lanjutkan bagaimana caranya buat multiple ports dan protokol, saya menggunakan script angristan, jika tidak sama bisa di sesuaikan karna tidak beda jauh\nÂ 3.a) Konfigurasi OpenVPN Server sebagai contoh, saya akan buat server OpenVPN baru di port 443/TCP dari settingan default angristan (1194/UDP). Login ke OpenVPN Server menggunakaan SSH\n copy / duplicate server.conf di folder /etc/openvpn/  \u0026gt; cd /etc/openvpn \u0026gt; ls | grep -E \u0026#34;server.*.conf$\u0026#34; -rw-r--r-- 1 root root 696 Dec 17 07:27 server.conf \u0026gt; cp server.conf server_tcp.conf edit file server_tcp.conf, sesuaikan seperti di bawah  # setting port, protokol port 443 proto tcp # setting Network OpenVPN Server server 172.16.111.0 255.255.255.0 # non-aktifkan static ip # ifconfig-pool-persist ipp.txt # setting log file untuk mode 443/TCP status /var/log/openvpn/status_tcp.log tambahkan rule masqurade agar network OpenVPN (172.16.111.x/24) dapat akses ke internet (interface eth0 / WAN)  iptables -t nat -A POSTROUTING -s 172.16.111.0/24 -o eth0 -j MASQUERADE Buat Config untuk Client, terserah namanya apa, format xxx.ovpn dan aktifkan OpenVPN server TCP tadi  \u0026gt; ./openvpn-install.sh \u0026gt; systemctl start openvpn@server_tcp \u0026gt; systemctl enable openvpn@server_tcp Â 3.a) Konfigurasi OpenVPN Client karna multi ports dan protkol tidak di dukung secara default oleh script angristan, maka saya akan modifikasi config auto-generated dari file openvpn-install.sh yang sudah di buat pada point 4 di atas\n pertama edit config file xxx.ovpn, ganti 4 baris teratas menjadi seperti di bawah  client proto tcp # explicit-exit-notify remote \u0026lt;ip openvpn server\u0026gt; 443 pindah xxx.ovpn ke client dan jalankan filenya  \u0026gt; sudo openvpn xxx.ovpn 2021-01-05 12:54:48 OPTIONS IMPORT: adjusting link_mtu to 1626 2021-01-05 12:54:48 OPTIONS IMPORT: data channel crypto options modified 2021-01-05 12:54:48 Outgoing Data Channel: Cipher \u0026#39;AES-128-GCM\u0026#39; initialized with 128 bit key 2021-01-05 12:54:48 Incoming Data Channel: Cipher \u0026#39;AES-128-GCM\u0026#39; initialized with 128 bit key 2021-01-05 12:54:48 TUN/TAP device tun0 opened 2021-01-05 12:54:48 net_iface_mtu_set: mtu 1500 for tun0 2021-01-05 12:54:48 net_iface_up: set tun0 up 2021-01-05 12:54:48 net_addr_v4_add: 172.16.111.2/24 dev tun0 2021-01-05 12:54:48 Initialization Sequence Completed  OpenVPN sudah berhasil connect ke OpenVPN server dengan protokol TCP port 443\n jika sudah berhasil, bisa kita buat service agar jalan secara otomatis  \u0026gt; cp xxx.ovpn /etc/openvpn/client/xxx.conf \u0026gt; sudo systemctl start openvpn-client@xxx \u0026gt; sudo systemctl enable openvpn-client@xxx Â Â Â 4) Terakhir  Gimane, simpel kan? cuman modifikasi beberapa baris aja dari config default bang angristan aja uda bisa setup OpenVPN server Multiple Port dan Protokol.\nGa cuman 2 OpenVPN Server doang, tapi bisa ratusan ğŸ˜‚, yang penting port nya cukup dan ga susah maintenance nantinya.\nUntuk port TCP/443 merupakan port teraman, karna port ini di gunakan oleh sejuta umat untuk akses website HTTPS \u0026hellip; di jamin Vendor tidak akan blocking ğŸ˜‹ bakal di amuk se RW entar \u0026hellip; kalaupun di block secara analisis packet data, kaga bisa, kan di encrypt ğŸ˜‚\n","permalink":"https://berrabe.github.io/id/posts/2021/openvpn-multiple-port-and-protocol/","summary":"1) TLDR  yo yo yo eee teammm \u0026hellip; welcome bek to my webseettt ğŸ˜§ \u0026hellip; selamat pagi, siang atau malam buat temen2, om, tante, pakdhe, budhe, simbah kakung, simbah putri dan semuanya dah ğŸ˜ª\nkali ini saya akan mendokumentasikan gimaneee caranyee setting banyak openvpn dalam satu server.\nMungkin kalian pernah berfikir untuk bypass limitasi yang di lakukan oleh pihak Vendor / ISP kan? semisal Vendor / ISP kalian tidak bisa buka reddit, netplik, skidipapap huahuahua, dsb.","title":"Openvpn Multiple Port and Protocol"},{"content":"Â Â 1) Masalah Besar pada OpenVPN  Saat saya menginstall openvpn dari script automasi bang angristan (fork dari script Nyr), saya bisa setup server openvpn dengan cepat (hanya 5 menit) dan langsung work, tanpa harus setting cert, ip, routing dll secara manual\ntapi ada satu masalah yang sangat simple tetepi membahayakan, dimana saya tidak bisa akses server client yang terkonek dengan jaringan OpenVPN!!!!, semua service tidak bisa di akses, mulai dari ping, ssh, sftp, webserver, dll \u0026hellip; oke oke, jangan tenang tetap panik ğŸ˜\n masalah ini terjadi pada server yang melewatkan semua trafik nya melalui jaringan OpenVPN terlebih dahulu baru ke internet (redirect-gateway def1 bypass-dhcp)\n Â Â Â 2) Masalah Itu di Selesaikan, Bukan Di Hindari  Oke pertama kita lihat dimana masalah nya, kita analisa atu-atu, pokoknya pantang tidur sebelum solved ğŸ˜´, biar simple \u0026hellip; saya analisa trafik dari service webserver saja, untuk service lain (ssh, sftp, ftp dll) sama saja kok prinsip nya\nÂ 2.a) Alur Paket Web (Standar) pertama kita harus tahu bagaimana sebuah trafik / lalu lintas paket itu bekerja ketika kita mengakses sebuah website dari sudut pandang client / end-user\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | \u0026lt;----+ | | +----------+ +------------+ +--------------+ wewww, grafik yang sangat simpel bukan? saya kasih log web server nih, biar agak detail dikit ğŸ˜…\n180.254.92.138 - - [04/Jan/2021:09:57:29 +0000] \u0026#34;GET / HTTP/1.1\u0026#34; 200 612 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (X11; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0\u0026#34; \u0026#34;-\u0026#34; 180.254.92.138 - - [04/Jan/2021:09:57:30 +0000] \u0026#34;GET /favicon.ico HTTP/1.1\u0026#34; 404 153 \u0026#34;http://36.80.241.251/\u0026#34; \u0026#34;Mozilla/5.0 (X11; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0\u0026#34; \u0026#34;-\u0026#34; okehhh, perlu di inget dulu ye, ip public saya adalah 180.254.92.138 (sama seperti yang ada di log). Brati kalo saya simpulkan, cara kerja web server itu, dia akan mengembalikan request sesuai alamat ip client yang meminta.\nJadi semisal ip public saya 180.254.92.138 melakukan request ke google, ya google akan ngembaliin request ke ip public komputer saya, yaitu 180.254.92.138 \u0026hellip; bukannya ke ip 2.2.2.2 punyanya komputer pak RT ğŸ˜‚\nÂ 2.b) Alur Paket Web (OpenVPN) okeh bosq, sekarang kita uda tau bagaimana paket web standar itu bekerja, trus sekarang kita lihat trafik yang menggunakan OpenVPN kenapa tidak bekerja ğŸ˜¢\nmari kita lihat grafik nya\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ jika di lihat sekilas, seharusnya tidak ada masalah bukan? request dari client menuju web server, kemudian di kembalikan ke client, Normal and Simpel \u0026hellip; Hanya saja sebelum di kembalikan ke client, trafik di lewatkan ke jaringan OpenVPN terlebih dahulu\neits, tidak semudah itu ferguso \u0026hellip; kenyatannya trafik request dari client tidak sampai / balik lagi ke client alias PUTUS, trafik ini berlaku tidak hanya untuk service web, tapi semua service dari ssh, sftp, ftp dll\nÂ 2.c) Masalah nya tu disini \u0026hellip;. Intinya, saat client mengakses service (ping, ssh, web server, dll) di server yang semua traffik nya ter-redirect / dilewatkan ke OpenVPN, trafik tidak bisa kembali lagi ke client. Nah Loh ğŸ˜±\nDari pada vusing dan ngawang knape bisa gitu, mari kita analisis secara mendalam menggunakan wireshark-cli / tshark. Untuk mempermudah pengecekan, kita akan menggunakan protokol icmp / ping \u0026hellip; klo pake http ribet cyinn (ngelesss) ğŸ˜¬\ntapi sebelum itu, kita harus tahu trafik ping yang normal itu seperti apa\n\u0026gt; ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. 64 bytes from 1.1.1.1: icmp_seq=1 ttl=55 time=29.6 ms 64 bytes from 1.1.1.1: icmp_seq=2 ttl=55 time=30.6 ms # wireshark-cli Capturing on \u0026#39;wlp9s0\u0026#39; 1 0.000000000 180.254.92.138 â†’ 1.1.1.1 ICMP 98 Echo (ping) request id=0x0016, seq=1/256, ttl=64 2 0.028321186 1.1.1.1 â†’ 180.254.92.138 ICMP 98 Echo (ping) reply id=0x0016, seq=1/256, ttl=55 (request in 1) 3 1.001599961 180.254.92.138 â†’ 1.1.1.1 ICMP 98 Echo (ping) request id=0x0016, seq=2/512, ttl=64 4 1.045006664 1.1.1.1 â†’ 180.254.92.138 ICMP 98 Echo (ping) reply id=0x0016, seq=2/512, ttl=55 (request in 3) okeh, traffik yang sangat sederhana, dimana saya sebagai client (180.254.92.138) melakukan ping (request) ke cloudflared (1.1.1.1) dan di balas dengan paket (reply)\nsekarang mari kita lihat trafik saat kita ping server yang semua traffic nya ter-redirect melewati OpenVPN\n\u0026gt; ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. # wireshark-cli Capturing on \u0026#39;wlp9s0\u0026#39; 1 0.000000000 180.254.92.138 â†’ 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=1/256, ttl=54 2 1.169998179 180.254.92.138 â†’ 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=2/512, ttl=54 3 2.036470879 180.254.92.138 â†’ 114.xx.xx.21 ICMP 98 Echo (ping) request id=0x663a, seq=3/768, ttl=54 loh loh, kok command ping nya stcuk dan paket nya request saja? tidak ada balasan / reply? seperti cinta bertepuk sebelah tangan bukan? ğŸ˜›\nÂ Â Â 3) Menyelesaikan Masalah Tanpa Solusi  setelah mencari wangsit dari sabang sampai merauke, akhirnya saya dapat akar masalahnya ğŸ˜‚ .. sebelum itu mari kita lihat grafik trafik sekali lagi\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ jika kita amati di Web Server, kita bisa lihat bahwa jalur trafik masuk dan keluar itu berbeda bukan? katakanlah masuk lewat pintu depan dan keluar lewat jendela\nperlu di ingat bahwa komputer hanya malayani trafik default, di mana trafik masuk dan keluar lewat pintu depan \u0026hellip; Tapi jangan putus asa dulu, mau tahu cara solved nya? jangan kasi kendor, baca terus sampai bawah ğŸ˜Š\nÂ 3.a) Skenario 1 sebelum mulai, kita lihat gambaran skema trafik flow dari skenario 1 ini\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | \u0026lt;----+ | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ secara garis besar tidak ada perubahan, tetapiiii jika kita perhatikan di Web Server, ada panah bolak-balik yang menandakan, trafik client yang masuk pintu depan, akan kita balikkan ke pintu depan lagi dari pada kita redirect / alihkan melalui jendala (OpenVPN)\ntraffic di atas bisa di lakukan dengan routing ke arah ip public client yang mengakses server\n\u0026gt; ip route add \u0026lt; ip public client \u0026gt; dev \u0026lt; interface WAN server \u0026gt; # Contoh \u0026gt; ip route add 1.1.1.1 dev eth0  kekurangan dari solusi ini adalah kita harus routing satu2 public ip client yang ingin terhubung / akses ke server\n Â 3.b) Skenario 2 skenarion ke 2 ini akan tetap mempertahankan skema awal trafic, dimana trafik masuk dari pintu depan (eth0 WAN Internet) dan keluar melalui jendela (tun0 - OpenVPN) dengan menggunakan chain filter dan nat masqurade. Untuk skema trafik nya seperti di bawah ini\n+----------+ +------------+ +--------------+ | | | | | | | Client | +----\u0026gt; | Internet | +----\u0026gt; | Web Server | | | \u0026lt;----+ | | | | +----------+ +------+-----+ +--------------+ ^ | + +--------+---------+ | | | | | OpenVPN Server | \u0026lt;------------+ | | +------------------+ semua bisa di lakukan dengan cara\n# ipv4 forward \u0026gt; sysctl -w net.ipv4.ip_forward=1 # accept forward chain \u0026gt; iptables -A FORWARD --in-interface eth0 -j ACCEPT # masking ip (NAT) after routing process \u0026gt; iptables --table nat -A POSTROUTING --out-interface tun0 -j MASQUERADE  kekurangan dari solusi ini adalah, tidak semua service akan berhasil. karena akan di anggap sebagai serangan MITM / spoofing. dimana kita meminta (request) ke server ip 1.1.1.1 tapi yang membalas (reply) adalah server ip 5.5.5.5\n Â 3.c) Skenario 3 ada 2 skenario terakhir dan ini solusi yang recommended menurut saya, yaitu\n Pertama, non-aktifkan redirecting all traffic  berguna agar tidak semua traffic di lewatkan OpenVPN, hanya network ip tertentu saja yang di lewatkan. Delete / Comment baris seperti di bawah    # redirect-gateway def1 bypass-dhcp  Kedua, jika ingin tetap melewatkan semua trafic melewati jaringan OpenVPN, gunakan fitur packet marking yang ada di iptables\n rule ini berfungsi untuk menandai setiap packet yang masuk ke server. Yang mana nantinya packet response akan melewati jalan di mana packet tersebut masuk.  sebagai contoh, jika kita masuk lewat pintu depan, maka saat kita keluar, server akan mengarahkan lewat pintu depan juga, tidak lewat jendela seperti sebelumnya\n  untuk point 2 explore sendiri yeee, ribet cyin soalnyeee \u0026hellip; nih link nya ğŸ˜‚\n","permalink":"https://berrabe.github.io/id/posts/2021/openvpn-redirect-problem/","summary":"1) Masalah Besar pada OpenVPN  Saat saya menginstall openvpn dari script automasi bang angristan (fork dari script Nyr), saya bisa setup server openvpn dengan cepat (hanya 5 menit) dan langsung work, tanpa harus setting cert, ip, routing dll secara manual\ntapi ada satu masalah yang sangat simple tetepi membahayakan, dimana saya tidak bisa akses server client yang terkonek dengan jaringan OpenVPN!!!!, semua service tidak bisa di akses, mulai dari ping, ssh, sftp, webserver, dll \u0026hellip; oke oke, jangan tenang tetap panik ğŸ˜","title":"Openvpn Redirect Problem"},{"content":"","permalink":"https://berrabe.github.io/id/archives/","summary":"archives","title":"Archive"},{"content":"","permalink":"https://berrabe.github.io/id/search/","summary":"","title":"Pencarian"}]