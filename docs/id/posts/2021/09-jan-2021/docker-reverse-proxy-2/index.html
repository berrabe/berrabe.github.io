<!doctype html><html lang=id dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Reverse Proxy #2 | Docs | berrabe</title><meta name=keywords content="Docker,Linux,Automation"><meta name=description content="1) TLDR  oke &mldr; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1
pada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server ğŸ˜‡
+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------> | INTERNET | +-------> | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a."><meta name=author content="berrabe"><link rel=canonical href=https://berrabe.github.io/id/posts/2021/09-jan-2021/docker-reverse-proxy-2/><link href=https://berrabe.github.io/assets/css/stylesheet.min.b6e4fb9d9486ee9750cbbe1b4e388ff4332a2d1e0d17ab3592ecb6c6f7ba1157.css integrity="sha256-tuT7nZSG7pdQy74bTjiP9DMqLR4NF6s1kuy2xve6EVc=" rel="preload stylesheet" as=style><link rel=icon href=https://berrabe.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://berrabe.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://berrabe.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://berrabe.github.io/apple-touch-icon.png><link rel=mask-icon href=https://berrabe.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-187127468-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Docker Reverse Proxy #2"><meta property="og:description" content="1) TLDR  oke &mldr; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1
pada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server ğŸ˜‡
+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------> | INTERNET | +-------> | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a."><meta property="og:type" content="article"><meta property="og:url" content="https://berrabe.github.io/id/posts/2021/09-jan-2021/docker-reverse-proxy-2/"><meta property="og:image" content="https://miro.medium.com/max/2800/1*rnzxfcy2N_ffJPnBundJQw.jpeg"><meta property="article:published_time" content="2021-01-23T17:49:50+07:00"><meta property="article:modified_time" content="2021-01-23T17:49:50+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://miro.medium.com/max/2800/1*rnzxfcy2N_ffJPnBundJQw.jpeg"><meta name=twitter:title content="Docker Reverse Proxy #2"><meta name=twitter:description content="1) TLDR  oke &mldr; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1
pada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server ğŸ˜‡
+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------> | INTERNET | +-------> | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Reverse Proxy #2","name":"Docker Reverse Proxy #2","description":"1) TLDR  oke \u0026amp;hellip; artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1\npada docker reverse proxy #1, saya sudah berhasil memisahkan website â€¦","keywords":["Docker","Linux","Automation"],"articleBody":"Â Â 1) TLDR  oke â€¦ artikel kali ini akan singkat saja karna cuman lanjutan dari docker reverse proxy #1\npada docker reverse proxy #1, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server ğŸ˜‡\n+-----------------------------+ | SERVER 1 | +--------------+ | | +--------+ | | | = WordPress | | USER | +------ | INTERNET | +------- | = PHPMyAdmin | +--------+ | | | = Grafana | +--------------+ | = test (a.berrabe.com) | | | +-----------------------------+ domain tester pada docker reverse proxy #1 bernama a.berrabe.com, dimana container upstream nya berupa web server dari nginx:alpine\nâš ï¸ Note : domain tester hanya di gunakan untuk ngetest auto-gen mapping domain reverse-proxy nya dan auto-gen SSL Certs letsencrypt domain\nterus artikel lanjutan ini di buat untuk apa? ğŸ˜Ÿ\njadi gini â€¦ kemarin di docker reverse proxy #1 ada peringatan, bahwa reverse-proxy ini secara default hanya bisa di gunakan pada container yang berjalan di atas network bridge, selain itu? â€¦ gatau dahh mwehehehe ğŸ˜‚ Â Â 2) Selalu Punya Yang Baru  katakanlah saya ingin menjalankan aplikasi php framework laravel / CI, dengan infranya berupa stack nginx, php-fpm, dan mariaDB â€¦ di docker, stack infra tadi biasanya di jalankan melalui docker-compose\nmasalahnya, secara default docker-compose akan membuat network baru untuk stack infra tadi, biasanya di ambil dari nama folder tempat file docker-compose.yml di simpan\ndocker-php-framework/ â”œâ”€â”€ docs/ â”œâ”€â”€ nginx/ â”œâ”€â”€ Dockerfile â”œâ”€â”€ docker-compose.yml jika file docker-compose.yml di atas di up dengan docker-compose up -d, maka secara default network dockerphpframework_default akan dibuat\nyang mana nantinya, docker reverse proxy tidak bisa memforward packet dari reverse-proxy ke aplikasi upstream (docker-php-framework) karna beda network\n docker reverse proxy di atas network bridge sedangkan docker-php-framework / upstream di atas network dockerphpframework_default  Â Â Â 3) Menyelesaikan Masalah Tanpa Solusi  sebetulnya cara resolve nya sangat sederhana, ada 2 cara:\n ubah network di docker-compose.yml stack infra upstream ke network bridge, dan menggunakan fitur legacy links jika container di dalam stack ingin saling terhubung atau setup container docker reverse-proxy untuk join ke semua network yang tersedia, kecuali network host dan none  saya lebih memilih cara ke 2, karna lebih mudah menyesuaikan satu container agar bisa work dari pada sebaliknya â€¦ dan juga cara 1 menggunakan fitur legacy links yang mana sudah tidak di rekomendasi oleh docker\nÂ Â Â 4) Semua Serba Otomatis  okeh .. sekarang sudah jelas, yang perlu di lakukan adalah memasukkan container docker reverse proxy ke semua network agar proses proxy pass dapat bekerja ğŸ˜µ\nhhmm, tpi semisal saya jalanin 10 aplikasi, dan setiap aplikasi pakai compose, dan setiap compose punya network sendiri-sendiri, repot juga yak klo harus docker network connect atu-atu ğŸ˜©\nuntuk itulah saya membuat script automasi nya ğŸ˜\n#!/bin/bash  # ------------------------------------------------- _CONTAINER_NAME_=$1 # ------------------------------------------------- clear echo -e \"\\t ./ Docker Auto Join Network \\.\\n\\n\" function check() { if [[ $? -eq 0 ]]; then echo \"OK\" else echo \"ERROR $?\" exit fi } echo -e \" [+] LIST ALL DOCKER NETWORKS \" _ALL_NET_=$(docker network list --format \"{{.ID}}={{.Name}}\" | grep -vE \"host|none\") echo -e \"$_ALL_NET_\" | awk -F '=' '{printf \" |--[-] %s  %s\\n\", $1, $2}' echo -e \"\\n\\n [+] LIST [ $_CONTAINER_NAME_] CONTAINER CONNECTED NETWORKS\" _ALL_CONN_=$(docker inspect $_CONTAINER_NAME_ | grep \"NetworkID\" | awk -F '\"' '{print $4}' | cut -b -12) echo -e \"$_ALL_CONN_\" | awk '{if($1==\"\") $1=\"EMPTY\"; printf \" |--[-] %s\\n\", $1}' if [[ $_ALL_CONN_ == \"\" ]]; then exit fi echo -e \"\\n\\n [+] DISCONNECT ALL NETWORKS ATTACHED TO [ $_CONTAINER_NAME_] CONTAINER\" for i in $_ALL_CONN_; do printf \" |--[-] Disconecting %s ... \" \"$i\" docker network disconnect $i $_CONTAINER_NAME_ /dev/null 2\u00261 check done echo -e \"\\n\\n [+] CONNECTING [ $_CONTAINER_NAME_] TO ALL NETWORKS\" for i in $(echo -e \"$_ALL_NET_\" | awk -F '=' '{print $1}'); do printf \" |--[-] Connecting to %s ... \" \"$i\" docker network connect $i $_CONTAINER_NAME_ /dev/null 2\u00261 check done echo -ne \"\\n\\n [+] RESTART [ $_CONTAINER_NAME_] CONTAINER ... \" docker restart $_CONTAINER_NAME_ /dev/null 2\u00261 check masih ingat dengan direktori struktur di docker reverse proxy #1 ?\ndi sana di buat file bernama auto_net.brb â€¦ nah copy script di atas ke file itu, jangan lupa di beri exec permissions chmod +x auto_net.brb\nÂ Â Â 5) TESS â€¦ SSSTTTTT  agar container docker reverse proxy masuk ke semua network, caranya sangat simple ğŸ‘\n ./auto_net.brb di karenakan nama container default nya docker reverse proxy adalah reverse-proxy â€¦ maka command nya jadi ./auto_net reverse-proxy\n./ Docker Auto Join Network \\. [+] LIST ALL DOCKER NETWORKS |--[-] 329d3a2e32d8  05nginxdirlist_default |--[-] cefc731a02d6  06monitoringstack_default |--[-] a72740956861  berrabe_default |--[-] 7f23f3060488  bridge [+] LIST [ reverse-proxy ] CONTAINER CONNECTED NETWORKS |--[-] 7f23f3060488 [+] DISCONNECT ALL NETWORKS ATTACHED TO [ reverse-proxy ] CONTAINER |--[-] Disconecting 7f23f3060488 ... OK [+] CONNECTING [ reverse-proxy ] TO ALL NETWORKS |--[-] Connecting to 329d3a2e32d8 ... OK |--[-] Connecting to cefc731a02d6 ... OK |--[-] Connecting to a72740956861 ... OK |--[-] Connecting to 7f23f3060488 ... OK [+] RESTART [ reverse-proxy ] CONTAINER ... OK dann tadaaaa â€¦ container reverse-proxy sudah masuk ke semua network, jadi sekarang sudah bisa reverse-proxy ke semua container ğŸ‘ ğŸ‘ ğŸ‘\nuntuk lebih detail nya, bisa pakai command inspect\n docker inspect reverse-proxy | grep \"NetworkID\" \"NetworkID\": \"329d3a2e32d80d5da8accfc71fdc1142f8ca06d12ae7ed328950136aba6c27c9\", \"NetworkID\": \"cefc731a02d65e46b8085675b978d4abcf60c7a112ef0b829cf137870bc65424\", \"NetworkID\": \"a727409568618db52186fdd2c2ed8bddc36bd2379c098c2b1eabaabf6c08c317\", \"NetworkID\": \"7f23f306048847b82a36cacb517a6121c395ed48a9f3b2f784921915b78501f7\", Penjelasan :\n jika di lihat, awalnya container reverse-proxy hanya connect ke network bridge dengan hash 7f23f3060488 kemudian script akan disconnect container reverse-proxy dari semua network untuk mencegah error dan collision baru deh container bakal di konekin ulang ke semua network, list network bisa di lihat pakai command docker network list  ","wordCount":"902","inLanguage":"id","image":"https://miro.medium.com/max/2800/1*rnzxfcy2N_ffJPnBundJQw.jpeg","datePublished":"2021-01-23T17:49:50+07:00","dateModified":"2021-01-23T17:49:50+07:00","author":{"@type":"Person","name":"berrabe"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://berrabe.github.io/id/posts/2021/09-jan-2021/docker-reverse-proxy-2/"},"publisher":{"@type":"Organization","name":"Docs | berrabe","logo":{"@type":"ImageObject","url":"https://berrabe.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://berrabe.github.io/id/ accesskey=h title="Docs | berrabe (Alt + H)">Docs | berrabe</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span><span class=lang-switch><span>|</span><ul><li><a href=https://berrabe.github.io/ title=English aria-label=English>English</a></li></ul></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://berrabe.github.io/id/tags title=Tag><span>Tag</span></a></li><li><a href=https://berrabe.github.io/id/archives/ title=Arsip><span>Arsip</span></a></li><li><a href=https://berrabe.github.io/id/search/ title=Cari><span>Cari</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Docker Reverse Proxy #2</h1><div class=post-meta>January 23, 2021&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;berrabe</div></header><figure class=entry-cover><img src=https://miro.medium.com/max/2800/1*rnzxfcy2N_ffJPnBundJQw.jpeg alt="Loh Imange Nya Ilang"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><blockquote><ul><li><a href=#1-tldr aria-label="1) TLDR">1) TLDR</a></li><li><a href=#2-selalu-punya-yang-baru aria-label="2) Selalu Punya Yang Baru">2) Selalu Punya Yang Baru</a></li><li><a href=#3-menyelesaikan-masalah-tanpa-solusi aria-label="3) Menyelesaikan Masalah Tanpa Solusi">3) Menyelesaikan Masalah Tanpa Solusi</a></li><li><a href=#4-semua-serba-otomatis aria-label="4) Semua Serba Otomatis">4) Semua Serba Otomatis</a></li><li><a href=#5-tess--sssttttt aria-label="5) TESS &amp;hellip; SSSTTTTT">5) TESS &mldr; SSSTTTTT</a></li></ul></blockquote></details></div><div class=post-content><p>Â </p><p>Â </p><h2 id=1-tldr>1) TLDR<a hidden class=anchor aria-hidden=true href=#1-tldr>#</a></h2><hr><p>oke &mldr; artikel kali ini akan singkat saja karna cuman lanjutan dari <a href=https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/>docker reverse proxy #1</a></p><p>pada <a href=https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/>docker reverse proxy #1</a>, saya sudah berhasil memisahkan website berdasarkan domain yang di simpan pada satu server ğŸ˜‡</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>                                                  +-----------------------------+
                                                  |        SERVER <span style=color:#ae81ff>1</span>             |
                      +--------------+            |                             |
+--------+            |              |            |     <span style=color:#f92672>=</span> WordPress             |
|  USER  |  +------&gt;  |   INTERNET   | +-------&gt;  |     <span style=color:#f92672>=</span> PHPMyAdmin            |
+--------+            |              |            |     <span style=color:#f92672>=</span> Grafana               |
                      +--------------+            |     <span style=color:#f92672>=</span> test <span style=color:#f92672>(</span>a.berrabe.com<span style=color:#f92672>)</span>  |
                                                  |                             |
                                                  +-----------------------------+
</code></pre></div><p>domain tester pada <a href=https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/>docker reverse proxy #1</a> bernama <code>a.berrabe.com</code>, dimana container upstream nya berupa web server dari <code>nginx:alpine</code></p><p>âš ï¸ <strong>Note</strong> : domain tester hanya di gunakan untuk ngetest auto-gen mapping domain reverse-proxy nya dan auto-gen SSL Certs letsencrypt domain</p><p><strong>terus artikel lanjutan ini di buat untuk apa?</strong> ğŸ˜Ÿ</p><p>jadi gini &mldr; kemarin di <a href=https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/>docker reverse proxy #1</a> ada peringatan, bahwa reverse-proxy ini secara default hanya <strong>bisa di gunakan pada container yang berjalan di atas network bridge</strong>, selain itu?
&mldr; gatau dahh mwehehehe ğŸ˜‚
Â </p><p>Â </p><p>Â </p><h2 id=2-selalu-punya-yang-baru>2) Selalu Punya Yang Baru<a hidden class=anchor aria-hidden=true href=#2-selalu-punya-yang-baru>#</a></h2><hr><p>katakanlah saya ingin menjalankan aplikasi <a href=https://github.com/berrabe/docker-php-framework>php framework laravel / CI</a>, dengan infranya berupa stack nginx, php-fpm, dan mariaDB &mldr; di docker, stack infra tadi biasanya di jalankan melalui docker-compose</p><p>masalahnya, secara default docker-compose akan membuat network baru untuk stack infra tadi, biasanya di ambil dari nama folder tempat file <code>docker-compose.yml</code> di simpan</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>docker-php-framework/
   â”œâ”€â”€  docs/  
   â”œâ”€â”€  nginx/
   â”œâ”€â”€  Dockerfile  
   â”œâ”€â”€  docker-compose.yml
</code></pre></div><p>jika file <code>docker-compose.yml</code> di atas di up dengan <code>docker-compose up -d</code>, maka secara default network <code>dockerphpframework_default</code> akan dibuat</p><p>yang mana nantinya, <strong>docker reverse proxy</strong> tidak bisa memforward packet dari reverse-proxy ke aplikasi upstream <code>(docker-php-framework)</code> karna beda network</p><ul><li><strong>docker reverse proxy</strong> di atas network <code>bridge</code></li><li>sedangkan <strong>docker-php-framework / upstream</strong> di atas network <code>dockerphpframework_default</code></li></ul><p>Â </p><p>Â </p><p>Â </p><h2 id=3-menyelesaikan-masalah-tanpa-solusi>3) Menyelesaikan Masalah Tanpa Solusi<a hidden class=anchor aria-hidden=true href=#3-menyelesaikan-masalah-tanpa-solusi>#</a></h2><hr><p>sebetulnya cara resolve nya sangat sederhana, ada 2 cara:</p><ol><li>ubah network di <code>docker-compose.yml</code> stack infra upstream ke network <code>bridge</code>, dan menggunakan fitur legacy <code>links</code> jika container di dalam stack ingin saling terhubung</li><li>atau setup container <code>docker reverse-proxy</code> untuk join ke semua network yang tersedia, kecuali network <code>host</code> dan <code>none</code></li></ol><p>saya lebih memilih cara ke 2, karna lebih mudah menyesuaikan satu container agar bisa work dari pada sebaliknya &mldr; dan juga cara 1 menggunakan fitur legacy <code>links</code> yang mana sudah tidak di rekomendasi oleh docker</p><p>Â </p><p>Â </p><p>Â </p><h2 id=4-semua-serba-otomatis>4) Semua Serba Otomatis<a hidden class=anchor aria-hidden=true href=#4-semua-serba-otomatis>#</a></h2><hr><p>okeh .. sekarang sudah jelas, yang perlu di lakukan adalah memasukkan container <strong>docker reverse proxy</strong> ke semua network agar proses proxy pass dapat bekerja ğŸ˜µ</p><p>hhmm, tpi semisal saya jalanin 10 aplikasi, dan setiap aplikasi pakai compose, dan setiap compose punya network sendiri-sendiri, repot juga yak klo harus <code>docker network connect</code> atu-atu ğŸ˜©</p><p>untuk itulah saya membuat script automasi nya ğŸ˜</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># -------------------------------------------------</span>

_CONTAINER_NAME_<span style=color:#f92672>=</span>$1

<span style=color:#75715e># -------------------------------------------------</span>


clear
echo -e <span style=color:#e6db74>&#34;\t ./ Docker Auto Join Network \.\n\n&#34;</span>


<span style=color:#66d9ef>function</span> check<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
	<span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
		echo <span style=color:#e6db74>&#34;OK&#34;</span>
	<span style=color:#66d9ef>else</span>
		echo <span style=color:#e6db74>&#34;ERROR </span>$?<span style=color:#e6db74>&#34;</span>
		exit
	<span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>


echo -e <span style=color:#e6db74>&#34; [+] LIST ALL DOCKER NETWORKS &#34;</span>
_ALL_NET_<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>docker network list --format <span style=color:#e6db74>&#34;{{.ID}}={{.Name}}&#34;</span> | grep -vE <span style=color:#e6db74>&#34;host|none&#34;</span><span style=color:#66d9ef>)</span> 
echo -e <span style=color:#e6db74>&#34;</span>$_ALL_NET_<span style=color:#e6db74>&#34;</span> | awk -F <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#e6db74>&#39;{printf &#34;  |--[-] %s &gt;&gt;&gt; %s\n&#34;, $1, $2}&#39;</span>



echo -e <span style=color:#e6db74>&#34;\n\n [+] LIST [ </span>$_CONTAINER_NAME_<span style=color:#e6db74> ] CONTAINER CONNECTED NETWORKS&#34;</span>
_ALL_CONN_<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>docker inspect $_CONTAINER_NAME_ | grep <span style=color:#e6db74>&#34;NetworkID&#34;</span> | awk -F <span style=color:#e6db74>&#39;&#34;&#39;</span> <span style=color:#e6db74>&#39;{print $4}&#39;</span> | cut -b -12<span style=color:#66d9ef>)</span>
echo -e <span style=color:#e6db74>&#34;</span>$_ALL_CONN_<span style=color:#e6db74>&#34;</span> |  awk <span style=color:#e6db74>&#39;{if($1==&#34;&#34;) $1=&#34;EMPTY&#34;; printf &#34;  |--[-] %s\n&#34;, $1}&#39;</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $_ALL_CONN_ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
	exit
<span style=color:#66d9ef>fi</span>



echo -e <span style=color:#e6db74>&#34;\n\n [+] DISCONNECT ALL NETWORKS ATTACHED TO [ </span>$_CONTAINER_NAME_<span style=color:#e6db74> ] CONTAINER&#34;</span>
<span style=color:#66d9ef>for</span> i in $_ALL_CONN_; <span style=color:#66d9ef>do</span>
	printf <span style=color:#e6db74>&#34;  |--[-] Disconecting %s ... &#34;</span> <span style=color:#e6db74>&#34;</span>$i<span style=color:#e6db74>&#34;</span>
	docker network disconnect $i $_CONTAINER_NAME_ &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>

	check
<span style=color:#66d9ef>done</span>



echo -e <span style=color:#e6db74>&#34;\n\n [+] CONNECTING [ </span>$_CONTAINER_NAME_<span style=color:#e6db74> ] TO ALL NETWORKS&#34;</span>
<span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>echo -e <span style=color:#e6db74>&#34;</span>$_ALL_NET_<span style=color:#e6db74>&#34;</span> | awk -F <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
	printf <span style=color:#e6db74>&#34;  |--[-] Connecting to %s ... &#34;</span> <span style=color:#e6db74>&#34;</span>$i<span style=color:#e6db74>&#34;</span>
	docker network connect $i $_CONTAINER_NAME_ &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>

	check
<span style=color:#66d9ef>done</span>


echo -ne <span style=color:#e6db74>&#34;\n\n [+] RESTART [ </span>$_CONTAINER_NAME_<span style=color:#e6db74> ] CONTAINER ... &#34;</span>
docker restart $_CONTAINER_NAME_ &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
check
</code></pre></div><p>masih ingat dengan direktori struktur di <a href=https://berrabe.github.io/id/posts/2021/08-jan-2021/docker-reverse-proxy-1/>docker reverse proxy #1</a> ?</p><p>di sana di buat file bernama <code>auto_net.brb</code> &mldr; nah copy script di atas ke file itu, jangan lupa di beri exec permissions <code>chmod +x auto_net.brb</code></p><p>Â </p><p>Â </p><p>Â </p><h2 id=5-tess--sssttttt>5) TESS &mldr; SSSTTTTT<a hidden class=anchor aria-hidden=true href=#5-tess--sssttttt>#</a></h2><hr><p>agar container <strong>docker reverse proxy</strong> masuk ke semua network, caranya sangat simple ğŸ‘</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; ./auto_net.brb &lt;nama container&gt;
</code></pre></div><p>di karenakan nama container default nya <strong>docker reverse proxy</strong> adalah <code>reverse-proxy</code> &mldr; maka command nya jadi <code>./auto_net reverse-proxy</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>   ./ Docker Auto Join Network <span style=color:#ae81ff>\.</span>


 <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> LIST ALL DOCKER NETWORKS 
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> 329d3a2e32d8 &gt;&gt;&gt; 05nginxdirlist_default
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> cefc731a02d6 &gt;&gt;&gt; 06monitoringstack_default
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> a72740956861 &gt;&gt;&gt; berrabe_default
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> 7f23f3060488 &gt;&gt;&gt; bridge


 <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> LIST <span style=color:#f92672>[</span> reverse-proxy <span style=color:#f92672>]</span> CONTAINER CONNECTED NETWORKS
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> 7f23f3060488
  

 <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> DISCONNECT ALL NETWORKS ATTACHED TO <span style=color:#f92672>[</span> reverse-proxy <span style=color:#f92672>]</span> CONTAINER
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> Disconecting 7f23f3060488 ... OK


 <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> CONNECTING <span style=color:#f92672>[</span> reverse-proxy <span style=color:#f92672>]</span> TO ALL NETWORKS
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> Connecting to 329d3a2e32d8 ... OK
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> Connecting to cefc731a02d6 ... OK
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> Connecting to a72740956861 ... OK
  |--<span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> Connecting to 7f23f3060488 ... OK


 <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> RESTART <span style=color:#f92672>[</span> reverse-proxy <span style=color:#f92672>]</span> CONTAINER ... OK
</code></pre></div><p>dann tadaaaa &mldr; container reverse-proxy sudah masuk ke semua network, jadi sekarang sudah bisa reverse-proxy ke semua container ğŸ‘ ğŸ‘ ğŸ‘</p><p>untuk lebih detail nya, bisa pakai command inspect</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; docker inspect reverse-proxy | grep <span style=color:#e6db74>&#34;NetworkID&#34;</span>

<span style=color:#e6db74>&#34;NetworkID&#34;</span>: <span style=color:#e6db74>&#34;329d3a2e32d80d5da8accfc71fdc1142f8ca06d12ae7ed328950136aba6c27c9&#34;</span>,
<span style=color:#e6db74>&#34;NetworkID&#34;</span>: <span style=color:#e6db74>&#34;cefc731a02d65e46b8085675b978d4abcf60c7a112ef0b829cf137870bc65424&#34;</span>,
<span style=color:#e6db74>&#34;NetworkID&#34;</span>: <span style=color:#e6db74>&#34;a727409568618db52186fdd2c2ed8bddc36bd2379c098c2b1eabaabf6c08c317&#34;</span>,
<span style=color:#e6db74>&#34;NetworkID&#34;</span>: <span style=color:#e6db74>&#34;7f23f306048847b82a36cacb517a6121c395ed48a9f3b2f784921915b78501f7&#34;</span>,
</code></pre></div><p><strong>Penjelasan :</strong></p><ul><li>jika di lihat, awalnya container <code>reverse-proxy</code> hanya connect ke network <code>bridge</code> dengan hash <code>7f23f3060488</code></li><li>kemudian script akan disconnect container <code>reverse-proxy</code> dari semua network untuk mencegah error dan collision</li><li>baru deh container bakal di konekin ulang ke semua network, list network bisa di lihat pakai command <code>docker network list</code></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://berrabe.github.io/id/tags/docker/>Docker</a></li><li><a href=https://berrabe.github.io/id/tags/linux/>Linux</a></li><li><a href=https://berrabe.github.io/id/tags/automation/>Automation</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on twitter" href="https://twitter.com/intent/tweet/?text=Docker%20Reverse%20Proxy%20%232&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f&hashtags=Docker%2cLinux%2cAutomation"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f&title=Docker%20Reverse%20Proxy%20%232&summary=Docker%20Reverse%20Proxy%20%232&source=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f&title=Docker%20Reverse%20Proxy%20%232"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on whatsapp" href="https://api.whatsapp.com/send?text=Docker%20Reverse%20Proxy%20%232%20-%20https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Reverse Proxy #2 on telegram" href="https://telegram.me/share/url?text=Docker%20Reverse%20Proxy%20%232&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f09-jan-2021%2fdocker-reverse-proxy-2%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://berrabe.github.io/id/>Docs | berrabe</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=https://berrabe.github.io/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>