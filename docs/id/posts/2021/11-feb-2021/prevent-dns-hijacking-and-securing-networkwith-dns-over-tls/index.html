<!doctype html><html lang=id dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How To Prevent DNS Hijacking and Securing Local Network | Docs | berrabe</title><meta name=keywords content="Analysis,Docker,Linux,Security"><meta name=description content="1) Intro  okeh &mldr; selamat pagi, siang, ataupun malam &mldr; balek lagi ama saya, berrabe &mldr; orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜
kali ini saya pengen sharing lagi, sharing tentang keresahan saya menggunakan internet ğŸ˜­
jadi gini, saya punya beberapa masalah, seperti
 pengen buka web yang di blokir pemerintah, khusunya reddit, netflix, dkk tanpa vpn pengen mengamankan privasi saya, karna banyak banget tracking system di tanamkan pada app, web dll pengen memblock iklan di semua gadget saya, baik iklan di web, app dll tanpa install aplikasi di setiap gadget  âš ï¸ Note : masalah utama ada pada point 1 &mldr; point 2 dan 3 merupakan bonus"><meta name=author content="berrabe"><link rel=canonical href=https://berrabe.github.io/id/posts/2021/11-feb-2021/prevent-dns-hijacking-and-securing-networkwith-dns-over-tls/><link href=https://berrabe.github.io/assets/css/stylesheet.min.b6e4fb9d9486ee9750cbbe1b4e388ff4332a2d1e0d17ab3592ecb6c6f7ba1157.css integrity="sha256-tuT7nZSG7pdQy74bTjiP9DMqLR4NF6s1kuy2xve6EVc=" rel="preload stylesheet" as=style><link rel=icon href=https://berrabe.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://berrabe.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://berrabe.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://berrabe.github.io/apple-touch-icon.png><link rel=mask-icon href=https://berrabe.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-187127468-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="How To Prevent DNS Hijacking and Securing Local Network"><meta property="og:description" content="1) Intro  okeh &mldr; selamat pagi, siang, ataupun malam &mldr; balek lagi ama saya, berrabe &mldr; orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜
kali ini saya pengen sharing lagi, sharing tentang keresahan saya menggunakan internet ğŸ˜­
jadi gini, saya punya beberapa masalah, seperti
 pengen buka web yang di blokir pemerintah, khusunya reddit, netflix, dkk tanpa vpn pengen mengamankan privasi saya, karna banyak banget tracking system di tanamkan pada app, web dll pengen memblock iklan di semua gadget saya, baik iklan di web, app dll tanpa install aplikasi di setiap gadget  âš ï¸ Note : masalah utama ada pada point 1 &mldr; point 2 dan 3 merupakan bonus"><meta property="og:type" content="article"><meta property="og:url" content="https://berrabe.github.io/id/posts/2021/11-feb-2021/prevent-dns-hijacking-and-securing-networkwith-dns-over-tls/"><meta property="og:image" content="https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing-768x435.jpg.webp"><meta property="article:published_time" content="2021-02-08T15:28:38+07:00"><meta property="article:modified_time" content="2021-02-08T15:28:38+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing-768x435.jpg.webp"><meta name=twitter:title content="How To Prevent DNS Hijacking and Securing Local Network"><meta name=twitter:description content="1) Intro  okeh &mldr; selamat pagi, siang, ataupun malam &mldr; balek lagi ama saya, berrabe &mldr; orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜
kali ini saya pengen sharing lagi, sharing tentang keresahan saya menggunakan internet ğŸ˜­
jadi gini, saya punya beberapa masalah, seperti
 pengen buka web yang di blokir pemerintah, khusunya reddit, netflix, dkk tanpa vpn pengen mengamankan privasi saya, karna banyak banget tracking system di tanamkan pada app, web dll pengen memblock iklan di semua gadget saya, baik iklan di web, app dll tanpa install aplikasi di setiap gadget  âš ï¸ Note : masalah utama ada pada point 1 &mldr; point 2 dan 3 merupakan bonus"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How To Prevent DNS Hijacking and Securing Local Network","name":"How To Prevent DNS Hijacking and Securing Local Network","description":"1) Intro  okeh \u0026amp;hellip; selamat pagi, siang, ataupun malam \u0026amp;hellip; balek lagi ama saya, berrabe \u0026amp;hellip; orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜\nkali ini saya â€¦","keywords":["Analysis","Docker","Linux","Security"],"articleBody":"Â Â 1) Intro  okeh â€¦ selamat pagi, siang, ataupun malam â€¦ balek lagi ama saya, berrabe â€¦ orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜\nkali ini saya pengen sharing lagi, sharing tentang keresahan saya menggunakan internet ğŸ˜­\njadi gini, saya punya beberapa masalah, seperti\n pengen buka web yang di blokir pemerintah, khusunya reddit, netflix, dkk tanpa vpn pengen mengamankan privasi saya, karna banyak banget tracking system di tanamkan pada app, web dll pengen memblock iklan di semua gadget saya, baik iklan di web, app dll tanpa install aplikasi di setiap gadget  âš ï¸ Note : masalah utama ada pada point 1 â€¦ point 2 dan 3 merupakan bonus\nÂ Â Â 2) The Konspirasi  okeh â€¦ untuk yang belum tahu, cara kerja pemerintah dalam memblokir website / domain adalah menggunakan teknik DNS Hijacking / DNS Redirection ğŸ˜± ğŸ˜±\nuntuk lebih jelasnya, mari lihat cuplikan dari wikipedia ini\n A number of consumer ISPs such as AT\u0026T â€¦.. and Telkom Indonesia use DNS hijacking for their own purposes, such as displaying advertisements or collecting statistics, they were ordered to block access to The Pirate Bay and display a warning page instead.\n Â inti dari cuplikan wikipedia di atas adalah â€¦ bahwa di dunia ini, banyak ISP yang menerapkan teknik DNS Hijacking / DNS Redirection, contohnya ada AT\u0026T di Amerika, dan Telkom Indonesia.\ngunanya buat apa? untuk menampilkan iklan, mengkoleksi statistik penggunanya, dan memblock akses ke beberapa website yang di anggap buruk dengan memberikan halaman peringatan, kalau di indonesia ada internet positif dari telkom ğŸ˜”\nâš ï¸ Note : DNS Hijack juga sering di gunakan untuk kejahatan oleh para hacker. Biasanya target akan di redirect ke halaman phishing untuk di curi data sensitif nya ğŸ˜±\nÂ Â Â 3) Bagaimana Cara Kerjanya  setelah tau teknik apa yang di gunakan ISP beserta alasannya, saat nya ngulik lebih dalam tentang bagaimana cara kerjanya ğŸ˜Š\nÂ 3.a) Normal DNS cara kerja DNS sangat sederhana, di mana DNS berguna untuk men-translate domain ke ip\nwhat ?? kenapa harus kek gitu, ribet amat dah â€¦. ğŸ˜¤ ğŸ˜©\ngampangnya, komputer harus bekerja dengan alamat IP, sedangkan manusia susah untuk menghapal alamat IP, makanya manusia pakai domain name kaya google.com, facebook.com, dll\n dig google.com ;; ANSWER SECTION: google.com.\t68\tIN\tA\t74.125.200.139 google.com.\t68\tIN\tA\t74.125.200.138 google.com.\t68\tIN\tA\t74.125.200.101 google.com.\t68\tIN\tA\t74.125.200.113 google.com.\t68\tIN\tA\t74.125.200.102 google.com.\t68\tIN\tA\t74.125.200.100 nah tuh, bayangin manusia harus ngapalin ip 74.125.200.139 - dst untuk ngakses google â€¦ ribet kan? ğŸ˜¢ ğŸ˜¢\nbelum lagi hafalin IP untuk akses web / app yang lain kaya facebook, instagram, twitter dkk ğŸ˜±\nÂ 3.b) Hijacked / Redirected DNS oke, sekarang cara kerja DNS hijack, intinya sama saja seperti normal DNS â€¦. tapiii, ada tapinya nih\ntapi, sebelum DNS Trafik sampe ke DNS Server tujuan ( contoh : google DNS 8.8.8.8 ), Trafik DNS tadi di cegat oleh ISP dan di belokin paksa / force-redirect ke DNS Server ISP\n+--------------+ +----------+ +----------+ +---------+ | | | | | | | | | GOOGLE DNS | | CLIENT | +--- | ROUTER | +--- | ISP | +---- | 8.8.8.8 | | | | | | | | 8.8.4.4 | +----------+ +----------+ +---------+ | | +--------------+ + ^ | | v + +---------+ | | | DNS ISP | | | +---------+ masih belum paham?\ncoba lihat hasilnya jika saya menggunakan DNS dari google 8.8.8.8 / 8.8.4.4\n dig @8.8.8.8 reddit.com ;; ANSWER SECTION: reddit.com.\t897\tIN\tCNAME\tinternetpositif.uzone.id. internetpositif.uzone.id. 27\tIN\tA\t36.86.63.185 nah loh â€¦ terlihat dengan jelas, bahwa domain reddit.com ter-redirect ke internet positif â€¦ padahal saya menggunakan DNS Google, kok aneh? ğŸ˜­ ğŸ˜­\nÂ lalu, bagaimana seharusnya domain yang benar / yang tidak ter-redirect itu? ğŸ˜¶ ğŸ˜¶\n dig @172.16.100.1 reddit.com ;; ANSWER SECTION: reddit.com.\t177\tIN\tA\t151.101.65.140 reddit.com.\t177\tIN\tA\t151.101.1.140 reddit.com.\t177\tIN\tA\t151.101.193.140 reddit.com.\t177\tIN\tA\t151.101.129.140 di atas, adalah hasil dari IP-IP domain reddit.com yang valid â€¦ ini menggunakan DNS Server di local saya, jadi tidak ter-hijack oleh ISP\njika saya ambil contoh 1 IP ( 151.101.65.140 ), lalu saya teliti, akan seperti ini\n curl ipinfo.io/151.101.65.140 { \"ip\": \"151.101.65.140\", \"anycast\": true, \"city\": \"San Francisco\", \"region\": \"California\", \"country\": \"US\", \"loc\": \"37.7621,-122.3971\", \"org\": \"AS54113 Fastly\", \"postal\": \"94107\", \"timezone\": \"America/Los_Angeles\", \"readme\": \"https://ipinfo.io/missingauth\" } oke, terlihat kan\nbahwa reddit.com dengan salah satu IP-nya yaitu 151.101.65.140 bukan 36.86.63.185\nsetelah saya cek bahwa IP berasal dari San Francisco, California, US dengan organisasi bernama Fastly (CDN) â€¦.. bukan internet positif ğŸ˜‚ ğŸ˜‚ ğŸ˜‚\nÂ 3.c) Test With Web / Script cara alternatif lain untuk mengecek apakah ISP menerapkan DNS Hijack, bisa dengan menggunakan teknik DNS leak test\ncontoh nya ada di :\n Website  https://www.dnsleaktest.com/ https://bash.ws/dnsleak   Terminal  https://github.com/macvk/dnsleaktest   WordPress Integration  https://github.com/macvk/vpn-leaks-test    Â Â Â 4) DNS Hijacking vs DNS Spoofing  oke, sedikit tambahan aja â€¦ di dunia IT Security, teknik-teknik pada peretasan menggunakan DNS itu banyak sekali â€¦ yang paling terkenal ada DNS Hijacking / DNS Redirection dan DNS Spoofing / Cache Poisoning\nintinya, kedua teknik di atas sama-sama mengubah IP dari domain name yang betul / valid menjadi IP yang salah\nseperti reddit.com di translate ke internet positif oleh DNS Telkom\ntapi, biasanya DNS Spoofing / Cache Poisoning terjadi pada cache DNS di local â€¦. sedangkan DNS Hijacking / DNS Redirection lebih kompleks, bisa terjadi karna trafik DNS di force redirect seperti yang di gunakan ISP, atau bisa terjadi karna terkena serangan malware\nÂ Â Â 5) Mencegah DNS Hijack  wokai â€¦ sebenarnya cara meng-atasi DNS Hijacking / DNS Redirection itu gampang-gampang susah ğŸ˜‚\nini saya kasih tau beberapa caranya\n  Hosts File\n cara ini merupakan cara yang paling sederhana tapi ampuh, tinggal modifikasi file hosts, kalau di linux ada di /etc/hosts   cat /etc/hosts 127.0.0.1 localhost 151.101.65.140 reddit.com   Pakai VPN\n ini adalah cara sejuta umat untuk buka web yang di block pemerintah, tapi kekurangannya satu, yaitu semua trafik akan di bungkus VPN, jadi akan ada overhead paket yang mengakibatkan latency bisa naik dan bandwidth cepet abis keunggulan dari cara ini, trafik akan sangat aman, tapi tergantung protokol VPN yang dipakai ya ğŸ˜…    The Modern Way\n oke, cara terakhir ini menurut saya cara yang paling modern, kenapa? â€¦. karna teknologi nya baru di implementasikan baru-baru ini ğŸ˜ Teknologi itu bernama DoT (DNS Over TLS) dan DoH (DNS Over HTTPS)    Â Â Â 6) DNS biasa vs DoT vs DoH vs DNSSEC  pada DNS biasa, trafik akan di lewatkan port 53 dengan protokol UDP â€¦ makanya trafik DNS tadi bisa dengan mudah di manipulasi / tampering oleh attacker / ISP dalam kasus ini\nlalu perbedaan dengan DNS biasa, DoT, DoH apa?\n   Metric DNS Biasa DoT DoH     Port 53 853 443   Protocol UDP TCP TCP   Encyption Plain UDP UDP + TLS / SSL HTTP / HTTP2 + TLS / SSL    lalu mana yang lebih baik? DoT atau DoH?\njujur saja, semua ini masih dalam perdebatan karna masing-masing ada plus-minus sendiri\n DoT  ini lebih baik jika di lihat dari sisi security endpoint, ini memudahkan seorang security administrator untuk memonitor, indentifikasi trafik yang lewat jalur 853/tcp   DoH  dari sudut pandang privasi, DoH lebih baik karna DoH menyatu dengan protokol yang di pakai semua orang untuk mengakses website, yaitu HTTPS â€¦ yang membuat seorang system administrator kesusahan dalam menganalisa / memonitor paket    lalu, apa itu DNSSEC?\ngampangnya, DNSSEC di rancang untuk mencegah serangan DNS Spoofing / Cache Poisoning â€¦ di mana DNSSEC ini merupakan kumpulan dari ekstensi security tambahan yang di gunakan untuk mengidentifikasi DNS root server dan authoritative nameservers dalam komunikasi dengan DNS Resolver\nuntuk lebih jelasnya, silahkan baca di sini\nÂ Â Â 7) Menggunakan / Membuat DoT dan DoH  oke â€¦ ini bab terakhir, yaitu gimana caranya gunain / membuat sendiri (self-hosted) DoT maupun DoH\nÂ 7.a) Menggunakan DoT / DoH ada beberapa cara untuk menggunakan layanan DoT / DoH yang sudah ada, tanpa harus membuat sendiri\n  Android\n mulai dari versi 9, ada pengaturan Private DNS di Connection Setting â€¦ ini memungkinkan android menggunakan DoT untuk versi 8 kebawah, bisa menggunakan aplikasi semacam 1.1.1.1 punya cloudflare untuk DoT Server, saya biasanya menggunakan adguard tls://dns.adguard.com atau tls://dns-family.adguard.com    Linux / Windows / Mac\n untuk Linux / Windows / Mac, bisa menggunakan aplikasi DoH punya cloudflare, bisa di lihat di sini untuk dokumentasi nya dan untuk binary nya bisa di download di sini atau bisa juga menggunakan aplikasi dnscrypt-proxy    âš ï¸ Note : provider DoT / DoH tidak selalu cloudflare, ada yang lain seperti adguard, Quad9, Google DNS dkk â€¦ tapi yang saya tahu, cloudflare lah yang paling cepat dan reliable, tapi kalau mau ada block iklan + basic security, bisa pakai adguard. list lengkap bisa di lihat di sini\nÂ Â 7.b) Membuat Server DoT / DoH cara membuat server DoT / DoH sangat sederhana dan mudah, yang paling terkenal dan yang saya tahu ada 2 cara, yaitu pakai PiHole atau Adguardhome\nsaya lebih memilih Adguardhome karna sangat simple, mudah dan fitur bawaannya banyak, sedangkan PiHole sudah ada fiturnya, tapi harus setup sendiri dengan tools yang berbeda (tidak include jadi satu)\nâš ï¸ Note : oiya, saya akan menginstall pakai docker biar gampang dan untuk tempat install nya, bisa di VPS, Cloud atau server sendiri â€¦ kalau saya pribadi, pakai server DIY dari bekas STB Indihome B860H V1 yang saya install linux / bisa juga RaspberryPi\nÂ 7.b.1) Install Docker pastikan docker sudah terinstall, jika belum ikutin langkah di bawah ini â€¦\n curl -fsSL https://get.docker.com -o get-docker.sh  sh get-docker.sh  systemctl start docker Â 7.b.2) Setup Adguardhome setelah docker terinstall, langkah selanjut tinggal setup adguardhome nya\nâš ï¸ Note : pastikan port 53/udp, 53/tcp, 80/tcp, 443/tcp, 853/tcp dan 3000/tcp tidak di gunakan oleh program lain\n mkdir DNS-Server \u0026\u0026 cd DNS-Server  docker run --name DNS-Server \\  -v $(pwd):/opt/adguardhome/work \\  -v $(pwd):/opt/adguardhome/conf \\  -p 53:53/tcp -p 53:53/udp \\  -p 80:80/tcp -p 443:443/tcp \\  -p 3000:3000/tcp \\  -p 853:853/tcp \\  -d adguard/adguardhome jika sudah menjalankan command diatas dan tidak ada error â€¦ selanjutnya setting adguard nya dengan masuk ke ip-server:3000\nnanti akan muncul tampilan seperti ini\nÂ 7.b.3) Config Adguardhome setelah setup selesai, adguardhome sudah bisa di gunakan sebagai DNS server pada port default 53, baik pakai TCP / UDP\ntapi sebelum itu, saya sarankan aktifkan filter DNS Blocklist agar domain untuk penyedia iklan seperti google ads, tracking system seperti google analytics dan domain-domain jahat lain seperti penyedia malware, phishing dkk di block\nmasuk ke Filters - DNS Blocklist\nÂ 7.b.4) Beautiful Adguardhome Dashboard hal yang paling saya suka dari adguardhome adalah â€¦ dashboard nya\nyap, bagi saya, dashboard nya itu clean, simple tapi sangat informatif\nÂ 7.b.5) Setup SSL adguardhome secara otomatis listen pada port default DNS port 53, baik TCP maupun UDP â€¦ ini seharusnya tidak masalah jika DNS Server berada di lokal\ntapi jika ingin di akses global, harus pakai DoT / DoH, karna jika pakai plain DNS port 53, akan kena DNS Hijack ISP ğŸ˜ª ğŸ˜ª\nuntuk membuat nya, step nya agak rumit ..\n pertama, pastikan sudah punya domain FQDN, contoh nya seperti dns.skidipapap.com kedua, buat SSL Cert untuk domain tadi, bisa pakai Lets Encypt kalau mau yang gratis, bisa di lihat di sini atau di sini jika ingin pakai docker ketiga, copy isi dari file cerficate dan private key ke Settings - Encryption Settings  Â 7.b.6) Saran Config Adguardhome saya akan beri beberapa saran agar adguardhome dapat optimal, cepat dan reliable\n  Tab Settings\n non-antifkan adguard browsing security web service maupun adguard parental control web service pada tab Settings - General Settings karna ini akan membebani kerja dari server dan memperlambat resolving DNS, untuk lebih jelasnya bisa di lihat di sini ubah upstream DNS Server ke DoT Cloudflare tls://1.1.1.1 pada tab Settings - DNS Settings, ini akan mempercepat resolving DNS karna Adguardhome tidak perlu menggunakan Bootstrap DNS Servers ubah rate limit menjadi 0 pada tab Settings - DNS Settings, untuk mencegah adanya resolv DNS queue naikkan nilai DNS Cache Configuration, agar buffer untuk DNS Caching lebih besar, membuat Resolv DNS lebih cepat karna tinggal load dari buffer memory tanpa harus resolv ke upstream server    Tab Filters\n jangan beri terlalu banyak rules pada DNS Blocklist, karna proses filtering memakan waktu yang cukup lama dan cpu intensive buat rules yang simple (menggunakan regex), adguardhome mendukung banyak filter rule scheme, bisa di lihat di sini    Â Â Â 8) Video By berrabe  Bypass DNS Hijack ISP with AdBlock on Your Local Network   ","wordCount":"2004","inLanguage":"id","image":"https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing-768x435.jpg.webp","datePublished":"2021-02-08T15:28:38+07:00","dateModified":"2021-02-08T15:28:38+07:00","author":{"@type":"Person","name":"berrabe"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://berrabe.github.io/id/posts/2021/11-feb-2021/prevent-dns-hijacking-and-securing-networkwith-dns-over-tls/"},"publisher":{"@type":"Organization","name":"Docs | berrabe","logo":{"@type":"ImageObject","url":"https://berrabe.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://berrabe.github.io/id/ accesskey=h title="Docs | berrabe (Alt + H)">Docs | berrabe</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span><span class=lang-switch><span>|</span><ul><li><a href=https://berrabe.github.io/ title=English aria-label=English>English</a></li></ul></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://berrabe.github.io/id/tags title=Tag><span>Tag</span></a></li><li><a href=https://berrabe.github.io/id/archives/ title=Arsip><span>Arsip</span></a></li><li><a href=https://berrabe.github.io/id/search/ title=Cari><span>Cari</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How To Prevent DNS Hijacking and Securing Local Network</h1><div class=post-meta>February 8, 2021&nbsp;Â·&nbsp;10 min&nbsp;Â·&nbsp;berrabe</div></header><figure class=entry-cover><img src=https://www.imperva.com/learn/wp-content/uploads/sites/13/2019/01/DNS-spoofing-768x435.jpg.webp alt="Loh Imange Nya Ilang"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><blockquote><ul><li><a href=#1-intro aria-label="1) Intro">1) Intro</a></li><li><a href=#2-the-konspirasi aria-label="2) The Konspirasi">2) The Konspirasi</a></li><li><a href=#3-bagaimana-cara-kerjanya aria-label="3) Bagaimana Cara Kerjanya">3) Bagaimana Cara Kerjanya</a><ul><li><a href=#3a-normal-dns aria-label="3.a) Normal DNS">3.a) Normal DNS</a></li><li><a href=#3b-hijacked--redirected-dns aria-label="3.b) Hijacked / Redirected DNS">3.b) Hijacked / Redirected DNS</a></li><li><a href=#3c-test-with-web--script aria-label="3.c) Test With Web / Script">3.c) Test With Web / Script</a></li></ul></li><li><a href=#4-dns-hijacking-vs-dns-spoofing aria-label="4) DNS Hijacking vs DNS Spoofing">4) DNS Hijacking vs DNS Spoofing</a></li><li><a href=#5-mencegah-dns-hijack aria-label="5) Mencegah DNS Hijack">5) Mencegah DNS Hijack</a></li><li><a href=#6-dns-biasa-vs-dot-vs-doh-vs-dnssec aria-label="6) DNS biasa vs DoT vs DoH vs DNSSEC">6) DNS biasa vs DoT vs DoH vs DNSSEC</a></li><li><a href=#7-menggunakan--membuat-dot-dan-doh aria-label="7) Menggunakan / Membuat DoT dan DoH">7) Menggunakan / Membuat DoT dan DoH</a><ul><li><a href=#7a-menggunakan-dot--doh aria-label="7.a) Menggunakan DoT / DoH">7.a) Menggunakan DoT / DoH</a></li><li><a href=#7b-membuat-server-dot--doh aria-label="7.b) Membuat Server DoT / DoH">7.b) Membuat Server DoT / DoH</a><ul><li><a href=#7b1-install-docker aria-label="7.b.1) Install Docker">7.b.1) Install Docker</a></li><li><a href=#7b2-setup-adguardhome aria-label="7.b.2) Setup Adguardhome">7.b.2) Setup Adguardhome</a></li><li><a href=#7b3-config-adguardhome aria-label="7.b.3) Config Adguardhome">7.b.3) Config Adguardhome</a></li><li><a href=#7b4-beautiful-adguardhome-dashboard aria-label="7.b.4) Beautiful Adguardhome Dashboard">7.b.4) Beautiful Adguardhome Dashboard</a></li><li><a href=#7b5-setup-ssl aria-label="7.b.5) Setup SSL">7.b.5) Setup SSL</a></li><li><a href=#7b6-saran-config-adguardhome aria-label="7.b.6) Saran Config Adguardhome">7.b.6) Saran Config Adguardhome</a></li></ul></li></ul></li><li><a href=#8-video-by-berrabe aria-label="8) Video By berrabe">8) Video By berrabe</a></li></ul></blockquote></details></div><div class=post-content><p>Â </p><p>Â </p><h2 id=1-intro>1) Intro<a hidden class=anchor aria-hidden=true href=#1-intro>#</a></h2><hr><p>okeh &mldr; selamat pagi, siang, ataupun malam &mldr; balek lagi ama saya, <strong>berrabe</strong> &mldr; orang yang selalu menyelesaikan masalah tanpa solusi ğŸ˜</p><p>kali ini saya pengen sharing lagi, sharing tentang keresahan saya menggunakan internet ğŸ˜­</p><p>jadi gini, saya punya beberapa masalah, seperti</p><ul><li>pengen buka web yang di blokir pemerintah, khusunya reddit, netflix, dkk tanpa vpn</li><li>pengen mengamankan privasi saya, karna banyak banget tracking system di tanamkan pada app, web dll</li><li>pengen memblock iklan di semua gadget saya, baik iklan di web, app dll tanpa install aplikasi di setiap gadget</li></ul><p>âš ï¸ <strong>Note</strong> : masalah utama ada pada point 1 &mldr; point 2 dan 3 merupakan bonus</p><p>Â </p><p>Â </p><p>Â </p><h2 id=2-the-konspirasi>2) The Konspirasi<a hidden class=anchor aria-hidden=true href=#2-the-konspirasi>#</a></h2><hr><p>okeh &mldr; untuk yang belum tahu, cara kerja pemerintah dalam memblokir website / domain adalah menggunakan teknik <strong>DNS Hijacking / DNS Redirection</strong> ğŸ˜± ğŸ˜±</p><p>untuk lebih jelasnya, mari lihat cuplikan dari <a href=https://en.wikipedia.org/wiki/DNS_hijacking>wikipedia ini</a></p><blockquote><p>A number of consumer ISPs such as AT&T &mldr;.. and Telkom Indonesia use DNS hijacking for their own purposes,
such as displaying advertisements or collecting statistics, they were ordered to block access to The Pirate Bay and display a warning page instead.</p></blockquote><p>Â </p><p>inti dari cuplikan wikipedia di atas adalah &mldr; bahwa di dunia ini, banyak ISP yang menerapkan teknik <strong>DNS Hijacking / DNS Redirection</strong>, contohnya ada AT&T di Amerika, dan Telkom Indonesia.</p><p>gunanya buat apa? untuk menampilkan iklan, mengkoleksi statistik penggunanya, dan memblock akses ke beberapa website yang di anggap buruk dengan memberikan halaman peringatan, kalau di indonesia ada <a href=http://internetpositif.uzone.id>internet positif</a> dari telkom ğŸ˜”</p><p>âš ï¸ <strong>Note</strong> : DNS Hijack juga sering di gunakan untuk kejahatan oleh para hacker. Biasanya target akan di redirect ke halaman phishing untuk di curi data sensitif nya ğŸ˜±</p><p>Â </p><p>Â </p><p>Â </p><h2 id=3-bagaimana-cara-kerjanya>3) Bagaimana Cara Kerjanya<a hidden class=anchor aria-hidden=true href=#3-bagaimana-cara-kerjanya>#</a></h2><hr><p>setelah tau teknik apa yang di gunakan ISP beserta alasannya, saat nya ngulik lebih dalam tentang bagaimana cara kerjanya ğŸ˜Š</p><p>Â </p><h3 id=3a-normal-dns>3.a) Normal DNS<a hidden class=anchor aria-hidden=true href=#3a-normal-dns>#</a></h3><p>cara kerja DNS sangat sederhana, di mana DNS berguna untuk men-translate domain ke ip</p><p>what ?? kenapa harus kek gitu, ribet amat dah &mldr;. ğŸ˜¤ ğŸ˜©</p><p>gampangnya, komputer harus bekerja dengan alamat IP, sedangkan manusia susah untuk menghapal alamat IP, makanya manusia pakai domain name kaya google.com, facebook.com, dll</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; dig google.com

;; ANSWER SECTION:
google.com.		68	IN	A	74.125.200.139
google.com.		68	IN	A	74.125.200.138
google.com.		68	IN	A	74.125.200.101
google.com.		68	IN	A	74.125.200.113
google.com.		68	IN	A	74.125.200.102
google.com.		68	IN	A	74.125.200.100
</code></pre></div><p>nah tuh, bayangin manusia harus ngapalin ip 74.125.200.139 - dst untuk ngakses google &mldr; ribet kan? ğŸ˜¢ ğŸ˜¢</p><p>belum lagi hafalin IP untuk akses web / app yang lain kaya facebook, instagram, twitter dkk ğŸ˜±</p><p>Â </p><h3 id=3b-hijacked--redirected-dns>3.b) Hijacked / Redirected DNS<a hidden class=anchor aria-hidden=true href=#3b-hijacked--redirected-dns>#</a></h3><p>oke, sekarang cara kerja DNS hijack, intinya sama saja seperti normal DNS &mldr;. tapiii, ada tapinya nih</p><p>tapi, sebelum DNS Trafik sampe ke DNS Server tujuan <code>( contoh : google DNS 8.8.8.8 )</code>, Trafik DNS tadi di cegat oleh ISP dan di belokin paksa / force-redirect ke DNS Server ISP</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>                                                                 +--------------+
+----------+          +----------+          +---------+          |              |
|          |          |          |          |         |          |  GOOGLE DNS  |
|  CLIENT  |  +---&gt;   |  ROUTER  |   +---&gt;  |   ISP   |   +----&gt; |  8.8.8.8     |
|          |          |          |          |         |          |  8.8.4.4     |
+----------+          +----------+          +---------+          |              |
                                                                 +--------------+
                                               +  ^
                                               |  |
                                               v  +

                                            +---------+
                                            |         |
                                            | DNS ISP |
                                            |         |
                                            +---------+
</code></pre></div><p>masih belum paham?</p><p>coba lihat hasilnya jika saya menggunakan DNS dari google <code>8.8.8.8 / 8.8.4.4</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; dig @8.8.8.8 reddit.com

;; ANSWER SECTION:
reddit.com.		897	IN	CNAME	internetpositif.uzone.id.
internetpositif.uzone.id. 27	IN	A	36.86.63.185
</code></pre></div><p>nah loh &mldr; terlihat dengan jelas, bahwa domain reddit.com <strong>ter-redirect</strong> ke internet positif &mldr; padahal saya menggunakan DNS Google, kok aneh? ğŸ˜­ ğŸ˜­</p><p>Â </p><p>lalu, bagaimana seharusnya domain yang benar / yang tidak <strong>ter-redirect</strong> itu? ğŸ˜¶ ğŸ˜¶</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; dig @172.16.100.1 reddit.com

;; ANSWER SECTION:
reddit.com.		177	IN	A	151.101.65.140
reddit.com.		177	IN	A	151.101.1.140
reddit.com.		177	IN	A	151.101.193.140
reddit.com.		177	IN	A	151.101.129.140
</code></pre></div><p>di atas, adalah hasil dari IP-IP domain reddit.com yang valid &mldr; <em>ini menggunakan DNS Server di local saya, jadi tidak ter-hijack oleh ISP</em></p><p>jika saya ambil contoh 1 IP <code>( 151.101.65.140 )</code>, lalu saya teliti, akan seperti ini</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; curl ipinfo.io/151.101.65.140

<span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;ip&#34;</span>: <span style=color:#e6db74>&#34;151.101.65.140&#34;</span>,
  <span style=color:#e6db74>&#34;anycast&#34;</span>: true,
  <span style=color:#e6db74>&#34;city&#34;</span>: <span style=color:#e6db74>&#34;San Francisco&#34;</span>,
  <span style=color:#e6db74>&#34;region&#34;</span>: <span style=color:#e6db74>&#34;California&#34;</span>,
  <span style=color:#e6db74>&#34;country&#34;</span>: <span style=color:#e6db74>&#34;US&#34;</span>,
  <span style=color:#e6db74>&#34;loc&#34;</span>: <span style=color:#e6db74>&#34;37.7621,-122.3971&#34;</span>,
  <span style=color:#e6db74>&#34;org&#34;</span>: <span style=color:#e6db74>&#34;AS54113 Fastly&#34;</span>,
  <span style=color:#e6db74>&#34;postal&#34;</span>: <span style=color:#e6db74>&#34;94107&#34;</span>,
  <span style=color:#e6db74>&#34;timezone&#34;</span>: <span style=color:#e6db74>&#34;America/Los_Angeles&#34;</span>,
  <span style=color:#e6db74>&#34;readme&#34;</span>: <span style=color:#e6db74>&#34;https://ipinfo.io/missingauth&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>oke, terlihat kan</p><p>bahwa reddit.com dengan salah satu IP-nya yaitu <code>151.101.65.140</code> bukan <code>36.86.63.185</code></p><p>setelah saya cek bahwa IP berasal dari San Francisco, California, US dengan organisasi bernama Fastly (CDN) &mldr;.. bukan <strong>internet positif</strong> ğŸ˜‚ ğŸ˜‚ ğŸ˜‚</p><p>Â </p><h3 id=3c-test-with-web--script>3.c) Test With Web / Script<a hidden class=anchor aria-hidden=true href=#3c-test-with-web--script>#</a></h3><p>cara alternatif lain untuk mengecek apakah ISP menerapkan DNS Hijack, bisa dengan menggunakan teknik <a href=https://bash.ws/dnsleak>DNS leak test</a></p><p>contoh nya ada di :</p><ul><li>Website<ul><li><a href=https://www.dnsleaktest.com/>https://www.dnsleaktest.com/</a></li><li><a href=https://bash.ws/dnsleak>https://bash.ws/dnsleak</a></li></ul></li><li>Terminal<ul><li><a href=https://github.com/macvk/dnsleaktest>https://github.com/macvk/dnsleaktest</a></li></ul></li><li>WordPress Integration<ul><li><a href=https://github.com/macvk/vpn-leaks-test>https://github.com/macvk/vpn-leaks-test</a></li></ul></li></ul><p>Â </p><p>Â </p><p>Â </p><h2 id=4-dns-hijacking-vs-dns-spoofing>4) DNS Hijacking vs DNS Spoofing<a hidden class=anchor aria-hidden=true href=#4-dns-hijacking-vs-dns-spoofing>#</a></h2><hr><p>oke, sedikit tambahan aja &mldr; di dunia IT Security, teknik-teknik pada peretasan menggunakan DNS itu banyak sekali &mldr; yang paling terkenal ada <strong>DNS Hijacking / DNS Redirection</strong> dan <strong>DNS Spoofing / Cache Poisoning</strong></p><p>intinya, kedua teknik di atas sama-sama mengubah IP dari domain name yang betul / valid menjadi IP yang salah</p><p>seperti reddit.com di translate ke internet positif oleh DNS Telkom</p><p>tapi, biasanya <strong>DNS Spoofing / Cache Poisoning</strong> terjadi pada cache DNS di local &mldr;. sedangkan <strong>DNS Hijacking / DNS Redirection</strong> lebih kompleks, bisa terjadi karna trafik DNS di force redirect seperti yang di gunakan ISP, atau bisa terjadi karna terkena serangan malware</p><p>Â </p><p>Â </p><p>Â </p><h2 id=5-mencegah-dns-hijack>5) Mencegah DNS Hijack<a hidden class=anchor aria-hidden=true href=#5-mencegah-dns-hijack>#</a></h2><hr><p>wokai &mldr; sebenarnya cara meng-atasi <strong>DNS Hijacking / DNS Redirection</strong> itu gampang-gampang susah ğŸ˜‚</p><p>ini saya kasih tau beberapa caranya</p><ul><li><p>Hosts File</p><ul><li>cara ini merupakan cara yang paling sederhana tapi ampuh, tinggal modifikasi file hosts, kalau di linux ada di <code>/etc/hosts</code></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; cat /etc/hosts

127.0.0.1        localhost
151.101.65.140   reddit.com
</code></pre></div></li><li><p>Pakai VPN</p><ul><li>ini adalah cara sejuta umat untuk buka web yang di block pemerintah, tapi kekurangannya satu,
yaitu semua trafik akan di bungkus VPN, jadi akan ada overhead paket yang mengakibatkan latency bisa naik
dan bandwidth cepet abis</li><li>keunggulan dari cara ini, trafik akan sangat aman, tapi tergantung protokol VPN yang dipakai ya ğŸ˜…</li></ul></li><li><p>The Modern Way</p><ul><li>oke, cara terakhir ini menurut saya cara yang paling modern, kenapa? &mldr;. karna teknologi nya baru
di implementasikan baru-baru ini ğŸ˜</li><li>Teknologi itu bernama DoT (DNS Over TLS) dan DoH (DNS Over HTTPS)</li></ul></li></ul><p>Â </p><p>Â </p><p>Â </p><h2 id=6-dns-biasa-vs-dot-vs-doh-vs-dnssec>6) DNS biasa vs DoT vs DoH vs DNSSEC<a hidden class=anchor aria-hidden=true href=#6-dns-biasa-vs-dot-vs-doh-vs-dnssec>#</a></h2><hr><p>pada DNS biasa, trafik akan di lewatkan port 53 dengan protokol UDP &mldr; makanya trafik DNS tadi bisa dengan mudah di manipulasi / tampering oleh attacker / ISP dalam kasus ini</p><p>lalu perbedaan dengan DNS biasa, DoT, DoH apa?</p><table><thead><tr><th>Metric</th><th>DNS Biasa</th><th>DoT</th><th>DoH</th></tr></thead><tbody><tr><td>Port</td><td>53</td><td>853</td><td>443</td></tr><tr><td>Protocol</td><td>UDP</td><td>TCP</td><td>TCP</td></tr><tr><td>Encyption</td><td>Plain UDP</td><td>UDP + TLS / SSL</td><td>HTTP / HTTP2 + TLS / SSL</td></tr></tbody></table><p>lalu mana yang lebih baik? DoT atau DoH?</p><p>jujur saja, semua ini masih dalam perdebatan karna masing-masing ada plus-minus sendiri</p><ul><li>DoT<ul><li>ini lebih baik jika di lihat dari sisi security endpoint, ini memudahkan seorang security administrator untuk memonitor, indentifikasi trafik yang lewat jalur 853/tcp</li></ul></li><li>DoH<ul><li>dari sudut pandang privasi, DoH lebih baik karna DoH menyatu dengan protokol yang di pakai semua orang untuk mengakses website, yaitu HTTPS &mldr; yang membuat seorang system administrator kesusahan dalam menganalisa / memonitor paket</li></ul></li></ul><p>lalu, apa itu DNSSEC?</p><p>gampangnya, DNSSEC di rancang untuk mencegah serangan <strong>DNS Spoofing / Cache Poisoning</strong> &mldr; di mana DNSSEC ini merupakan kumpulan dari ekstensi security tambahan yang di gunakan untuk mengidentifikasi <code>DNS root server</code> dan <code>authoritative nameservers</code> dalam komunikasi dengan <code>DNS Resolver</code></p><p>untuk lebih jelasnya, silahkan baca <a href=https://www.cloudflare.com/learning/dns/dns-over-tls/>di sini</a></p><p>Â </p><p>Â </p><p>Â </p><h2 id=7-menggunakan--membuat-dot-dan-doh>7) Menggunakan / Membuat DoT dan DoH<a hidden class=anchor aria-hidden=true href=#7-menggunakan--membuat-dot-dan-doh>#</a></h2><hr><p>oke &mldr; ini bab terakhir, yaitu gimana caranya gunain / membuat sendiri (self-hosted) DoT maupun DoH</p><p>Â </p><h3 id=7a-menggunakan-dot--doh>7.a) Menggunakan DoT / DoH<a hidden class=anchor aria-hidden=true href=#7a-menggunakan-dot--doh>#</a></h3><p>ada beberapa cara untuk menggunakan layanan DoT / DoH yang sudah ada, tanpa harus membuat sendiri</p><ul><li><p>Android</p><ul><li>mulai dari versi 9, ada pengaturan Private DNS di Connection Setting &mldr; ini memungkinkan android menggunakan DoT</li><li>untuk versi 8 kebawah, bisa menggunakan aplikasi semacam 1.1.1.1 punya cloudflare</li><li>untuk DoT Server, saya biasanya menggunakan adguard <code>tls://dns.adguard.com</code> atau <code>tls://dns-family.adguard.com</code></li></ul><p><img src=https://blog.cloudflare.com/content/images/2018/08/Screenshot_20180807-102253-1.png alt="Private DNS Cloudflare"></p></li><li><p>Linux / Windows / Mac</p><ul><li>untuk Linux / Windows / Mac, bisa menggunakan aplikasi DoH punya cloudflare, bisa di lihat <a href=https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy>di sini</a>
untuk dokumentasi nya dan untuk binary nya bisa di download <a href=https://developers.cloudflare.com/argo-tunnel/downloads>di sini</a></li><li>atau bisa juga menggunakan aplikasi <a href=https://dnscrypt.info/>dnscrypt-proxy</a></li></ul></li></ul><p>âš ï¸ <strong>Note</strong> : provider DoT / DoH tidak selalu cloudflare, ada yang lain seperti adguard, Quad9, Google DNS dkk &mldr; tapi yang saya tahu, cloudflare lah yang paling cepat dan reliable, tapi kalau mau ada block iklan + basic security, bisa pakai adguard. list lengkap bisa di lihat <a href=https://kb.adguard.com/en/general/dns-providers>di sini</a></p><p>Â </p><p>Â </p><h3 id=7b-membuat-server-dot--doh>7.b) Membuat Server DoT / DoH<a hidden class=anchor aria-hidden=true href=#7b-membuat-server-dot--doh>#</a></h3><p>cara membuat server DoT / DoH sangat sederhana dan mudah, yang paling terkenal dan yang saya tahu ada 2 cara, yaitu pakai PiHole atau Adguardhome</p><p>saya lebih memilih Adguardhome karna sangat simple, mudah dan fitur bawaannya banyak, sedangkan PiHole sudah ada fiturnya, tapi harus setup sendiri dengan tools yang berbeda (tidak include jadi satu)</p><p>âš ï¸ <strong>Note</strong> : oiya, saya akan menginstall pakai docker biar gampang dan untuk tempat install nya, bisa di VPS, Cloud atau server sendiri &mldr; kalau saya pribadi, pakai server DIY dari bekas STB Indihome B860H V1 yang saya install linux / bisa juga RaspberryPi</p><p>Â </p><h4 id=7b1-install-docker>7.b.1) Install Docker<a hidden class=anchor aria-hidden=true href=#7b1-install-docker>#</a></h4><p>pastikan docker sudah terinstall, jika belum ikutin langkah di bawah ini &mldr;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; curl -fsSL https://get.docker.com -o get-docker.sh
&gt; sh get-docker.sh
&gt; systemctl start docker
</code></pre></div><p>Â </p><h4 id=7b2-setup-adguardhome>7.b.2) Setup Adguardhome<a hidden class=anchor aria-hidden=true href=#7b2-setup-adguardhome>#</a></h4><p>setelah docker terinstall, langkah selanjut tinggal setup adguardhome nya</p><p>âš ï¸ <strong>Note</strong> : pastikan port 53/udp, 53/tcp, 80/tcp, 443/tcp, 853/tcp dan 3000/tcp tidak di gunakan oleh program lain</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&gt; mkdir DNS-Server <span style=color:#f92672>&amp;&amp;</span> cd DNS-Server
&gt; docker run --name DNS-Server <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/opt/adguardhome/work <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/opt/adguardhome/conf <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 53:53/tcp -p 53:53/udp <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 80:80/tcp -p 443:443/tcp <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 3000:3000/tcp <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p 853:853/tcp <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -d adguard/adguardhome
</code></pre></div><p>jika sudah menjalankan command diatas dan tidak ada error &mldr; selanjutnya setting adguard nya dengan masuk ke <code>ip-server:3000</code></p><p>nanti akan muncul tampilan seperti ini</p><p><img src=https://cdn.adguard.com/public/Adguard/Blog/AGHome/wizard.png alt="setup adguardhome"></p><p>Â </p><h4 id=7b3-config-adguardhome>7.b.3) Config Adguardhome<a hidden class=anchor aria-hidden=true href=#7b3-config-adguardhome>#</a></h4><p>setelah setup selesai, adguardhome sudah bisa di gunakan sebagai DNS server pada port default 53, baik pakai TCP / UDP</p><p>tapi sebelum itu, saya sarankan aktifkan filter DNS Blocklist agar domain untuk penyedia iklan seperti google ads, tracking system seperti google analytics dan domain-domain jahat lain seperti penyedia malware, phishing dkk di block</p><p>masuk ke <code>Filters -> DNS Blocklist</code></p><p><img src=https://res.cloudinary.com/canonical/image/fetch/f_auto,q_auto,fl_sanitize,w_819,h_503/https://dashboard.snapcraft.io/site_media/appmedia/2020/04/agh3_2Zqhv3A.png alt="adguardhome blocklist"></p><p>Â </p><h4 id=7b4-beautiful-adguardhome-dashboard>7.b.4) Beautiful Adguardhome Dashboard<a hidden class=anchor aria-hidden=true href=#7b4-beautiful-adguardhome-dashboard>#</a></h4><p>hal yang paling saya suka dari adguardhome adalah &mldr; dashboard nya</p><p>yap, bagi saya, dashboard nya itu clean, simple tapi sangat informatif</p><p><img src=https://cdn.adguard.com/public/Adguard/Blog/AGHome/dashboard.jpg alt="adguardhome dashboard"></p><p>Â </p><h4 id=7b5-setup-ssl>7.b.5) Setup SSL<a hidden class=anchor aria-hidden=true href=#7b5-setup-ssl>#</a></h4><p>adguardhome secara otomatis listen pada port default DNS port 53, baik TCP maupun UDP &mldr; ini seharusnya tidak masalah jika DNS Server berada di lokal</p><p>tapi jika ingin di akses global, harus pakai DoT / DoH, karna jika pakai plain DNS port 53, akan kena DNS Hijack ISP ğŸ˜ª ğŸ˜ª</p><p>untuk membuat nya, step nya agak rumit ..</p><ul><li>pertama, pastikan sudah punya domain FQDN, contoh nya seperti dns.skidipapap.com</li><li>kedua, buat SSL Cert untuk domain tadi, bisa pakai Lets Encypt kalau mau yang gratis, bisa di lihat <a href=https://letsencrypt.org/getting-started/>di sini</a>
atau <a href=https://certbot.eff.org/docs/install.html#running-with-docker>di sini jika ingin pakai docker</a></li><li>ketiga, copy isi dari file cerficate dan private key ke <code>Settings -> Encryption Settings</code></li></ul><p><img src=https://cdn.adguard.com/public/Adguard/Blog/AGHome/in-depth-review/home-encryption.png alt="encryption setting"></p><p>Â </p><h4 id=7b6-saran-config-adguardhome>7.b.6) Saran Config Adguardhome<a hidden class=anchor aria-hidden=true href=#7b6-saran-config-adguardhome>#</a></h4><p>saya akan beri beberapa saran agar adguardhome dapat optimal, cepat dan reliable</p><ul><li><p>Tab <strong>Settings</strong></p><ul><li>non-antifkan <em>adguard browsing security web service</em> maupun <em>adguard parental control web service</em> pada tab <em>Settings -> General Settings</em> karna ini akan membebani kerja dari server dan memperlambat resolving DNS, untuk lebih jelasnya bisa di lihat <a href=https://kb.adguard.com/en/general/how-malware-protection-works>di sini</a></li><li>ubah upstream DNS Server ke DoT Cloudflare <code>tls://1.1.1.1</code> pada tab <em>Settings -> DNS Settings</em>, ini akan mempercepat resolving DNS karna Adguardhome tidak perlu menggunakan <strong>Bootstrap DNS Servers</strong></li><li>ubah <em>rate limit</em> menjadi 0 pada tab <em>Settings -> DNS Settings</em>, untuk mencegah adanya resolv DNS queue</li><li>naikkan nilai <em>DNS Cache Configuration</em>, agar buffer untuk DNS Caching lebih besar, membuat Resolv DNS lebih cepat karna tinggal load dari buffer memory tanpa harus resolv ke upstream server</li></ul></li><li><p>Tab <strong>Filters</strong></p><ul><li>jangan beri terlalu banyak rules pada <em>DNS Blocklist</em>, karna proses filtering memakan waktu yang cukup lama dan cpu intensive</li><li>buat rules yang simple (menggunakan regex), adguardhome mendukung banyak filter rule scheme, bisa di lihat <a href=https://github.com/AdguardTeam/AdGuardHome/wiki/Hosts-Blocklists>di sini</a></li></ul></li></ul><p>Â </p><p>Â </p><p>Â </p><h2 id=8-video-by-berrabe>8) Video By berrabe<a hidden class=anchor aria-hidden=true href=#8-video-by-berrabe>#</a></h2><hr><p><strong>Bypass DNS Hijack ISP with AdBlock on Your Local Network</strong><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/rHvPWvnt_zI style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://berrabe.github.io/id/tags/analysis/>Analysis</a></li><li><a href=https://berrabe.github.io/id/tags/docker/>Docker</a></li><li><a href=https://berrabe.github.io/id/tags/linux/>Linux</a></li><li><a href=https://berrabe.github.io/id/tags/security/>Security</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on twitter" href="https://twitter.com/intent/tweet/?text=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f&hashtags=Analysis%2cDocker%2cLinux%2cSecurity"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f&title=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network&summary=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network&source=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f&title=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on whatsapp" href="https://api.whatsapp.com/send?text=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network%20-%20https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How To Prevent DNS Hijacking and Securing Local Network on telegram" href="https://telegram.me/share/url?text=How%20To%20Prevent%20DNS%20Hijacking%20and%20Securing%20Local%20Network&url=https%3a%2f%2fberrabe.github.io%2fid%2fposts%2f2021%2f11-feb-2021%2fprevent-dns-hijacking-and-securing-networkwith-dns-over-tls%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://berrabe.github.io/id/>Docs | berrabe</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=https://berrabe.github.io/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>